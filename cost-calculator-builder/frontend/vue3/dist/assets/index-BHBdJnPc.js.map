{"version":3,"file":"index-BHBdJnPc.js","sources":["../../src/widget/features/calculator-fields/components/Repeater/Repeater.vue"],"sourcesContent":["<template>\n  <div class=\"ccb-repeater-wrapper\">\n    <div\n      class=\"ccb-repeater-item\"\n      :class=\"{\n        'ccb-collapsed': collapseStore[idx],\n        [additionalClasses]: true,\n      }\"\n      v-for=\"(repeaterFieldMap, idx) in field.groupElements\"\n    >\n      <div\n        class=\"ccb-repeater-item--header\"\n        @click=\"collapseStore[idx] = !collapseStore[idx]\"\n      >\n        <span class=\"ccb-repeater-item--icon ccb-icon-Path-3514\"></span>\n        <span class=\"ccb-repeater-item--label\">{{ field.label }}</span>\n        <span class=\"ccb-repeater-item--counter\">#{{ idx + 1 }}</span>\n      </div>\n\n      <Transition name=\"fade\">\n        <div class=\"ccb-repeater-item--body\" v-if=\"!collapseStore[idx]\">\n          <div class=\"ccb-repeater-item--fields\">\n            <template\n              v-for=\"field in getFieldsFromMap(repeaterFieldMap)\"\n              :key=\"field.alias\"\n            >\n              <CalculatorField :name=\"field.fieldName\" :field=\"field\" />\n            </template>\n          </div>\n\n          <div class=\"ccb-repeater-item--actions\">\n            <Button\n              type=\"danger\"\n              :on-click=\"() => removeRepeater(idx)\"\n              :text=\"field.removeButtonLabel\"\n              icon=\"ccb-icon-Trash-filled\"\n              icon-position=\"before\"\n              :disabled=\"field.groupElements?.length === 1\"\n            />\n          </div>\n        </div>\n      </Transition>\n    </div>\n\n    <div class=\"ccb-repeater-actions\">\n      <Button\n        type=\"success-outlined\"\n        :on-click=\"addRepeater\"\n        :text=\"field.addButtonLabel\"\n        icon=\"ccb-icon-Add-Plus-Circle\"\n        icon-position=\"before\"\n        :disabled=\"disableStatusAddRepeaterBtn\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport {\n  Field,\n  IRepeaterField,\n  ISourceField,\n} from \"@/widget/shared/types/fields\";\nimport { computed, ref, toRefs } from \"vue\";\nimport CalculatorField from \"@/widget/features/calculator-fields/CalculatorField.vue\";\nimport Button from \"@/widget/shared/ui/components/Button/Button.vue\";\nimport { useFields } from \"@/widget/actions/fields/composable/useFields.ts\";\nimport { useFieldsStore } from \"@/widget/app/providers/stores/fieldsStore.ts\";\n\ntype Props = {\n  field: IRepeaterField;\n};\n\nconst props = defineProps<Props>();\nconst { field } = toRefs(props);\n\nconst fieldsStore = useFieldsStore();\nconst collapseStore = ref<Record<number, boolean>>({});\n\nconst getFieldsFromMap = computed(() => {\n  return (data: Map<string, Field>): Field[] => {\n    return Array.from(data.values());\n  };\n});\n\nconst removeRepeater = (idx: number) => {\n  if (confirm(\"Are you sure to delete the repeated group of elements?\")) {\n    const groupElements = field.value.groupElements;\n    if (Array.isArray(groupElements)) {\n      field.value.groupElements.splice(idx, 1);\n    }\n\n    field.value.groupElements.forEach((elements, idx) =>\n      Array.from(elements.entries()).forEach(([_, element]) => {\n        element.repeaterIdx = idx;\n      }),\n    );\n\n    fieldsStore.recalculateTotals();\n  }\n};\n\nconst addRepeater = () => {\n  if (field.value.repeatCount === field.value.groupElements.length) return;\n\n  const fieldsInstance = useFields();\n  const groupElements: Map<string, Field> = new Map();\n\n  const fields: ISourceField[] = field.value.originalElements || [];\n  for (const f of fields) {\n    const createdField: Field = fieldsInstance.addField(\n      f,\n      field.value.groupElements.length,\n      field.value.alias,\n    );\n\n    if (createdField) {\n      groupElements.set(f.alias, createdField);\n    }\n  }\n\n  field.value.groupElements.push(groupElements);\n\n  fieldsStore.recalculateTotals();\n};\n\nconst disableStatusAddRepeaterBtn = computed(\n  (): boolean => +field.value.repeatCount === field.value.groupElements.length,\n);\n\nconst additionalClasses = computed(() => {\n  return field.value?.additionalStyles || \"\";\n});\n</script>\n\n<style scoped lang=\"scss\">\n.ccb-repeater-wrapper {\n  display: flex;\n  flex-direction: column;\n  row-gap: 25px;\n\n  .ccb-repeater-item {\n    display: flex;\n    flex-direction: column;\n    border-left: 2px solid var(--ccb-container-dark-color);\n    padding-left: 15px;\n    row-gap: 8px;\n\n    &--fields {\n      display: flex;\n      flex-direction: column;\n      row-gap: 20px;\n    }\n\n    &--header {\n      cursor: pointer;\n      display: flex;\n      column-gap: 6px;\n      align-items: center;\n      padding: 5px 0;\n      color: var(--ccb-text-color);\n    }\n\n    &--icon {\n      font-size: 12px;\n      transition: 200ms linear;\n      transform: rotate(0);\n    }\n\n    &--label {\n      font-size: 16px;\n      font-weight: 600;\n    }\n\n    &--counter {\n      font-size: 16px;\n      opacity: 0.6;\n      font-weight: 600;\n    }\n\n    &--actions {\n      margin-top: 10px;\n      button {\n        padding: 10px 20px;\n      }\n    }\n\n    &.ccb-collapsed {\n      .ccb-repeater-item--icon {\n        transform: rotate(-180deg);\n      }\n    }\n  }\n}\n</style>\n"],"names":["props","__props","field","toRefs","fieldsStore","useFieldsStore","collapseStore","ref","getFieldsFromMap","computed","data","removeRepeater","idx","groupElements","elements","_","element","addRepeater","fieldsInstance","useFields","fields","f","createdField","disableStatusAddRepeaterBtn","additionalClasses","_a"],"mappings":"6zBAyEA,MAAMA,EAAQC,EACR,CAAE,MAAAC,CAAA,EAAUC,EAAOH,CAAK,EAExBI,EAAcC,EAAe,EAC7BC,EAAgBC,EAA6B,EAAE,EAE/CC,EAAmBC,EAAS,IACxBC,GACC,MAAM,KAAKA,EAAK,OAAA,CAAQ,CAElC,EAEKC,EAAkBC,GAAgB,CAClC,GAAA,QAAQ,wDAAwD,EAAG,CAC/D,MAAAC,EAAgBX,EAAM,MAAM,cAC9B,MAAM,QAAQW,CAAa,GAC7BX,EAAM,MAAM,cAAc,OAAOU,EAAK,CAAC,EAGzCV,EAAM,MAAM,cAAc,QAAQ,CAACY,EAAUF,IAC3C,MAAM,KAAKE,EAAS,QAAS,CAAA,EAAE,QAAQ,CAAC,CAACC,EAAGC,CAAO,IAAM,CACvDA,EAAQ,YAAcJ,CACvB,CAAA,CACH,EAEAR,EAAY,kBAAkB,CAAA,CAElC,EAEMa,EAAc,IAAM,CACxB,GAAIf,EAAM,MAAM,cAAgBA,EAAM,MAAM,cAAc,OAAQ,OAElE,MAAMgB,EAAiBC,EAAU,EAC3BN,MAAwC,IAExCO,EAAyBlB,EAAM,MAAM,kBAAoB,CAAC,EAChE,UAAWmB,KAAKD,EAAQ,CACtB,MAAME,EAAsBJ,EAAe,SACzCG,EACAnB,EAAM,MAAM,cAAc,OAC1BA,EAAM,MAAM,KACd,EAEIoB,GACYT,EAAA,IAAIQ,EAAE,MAAOC,CAAY,CACzC,CAGIpB,EAAA,MAAM,cAAc,KAAKW,CAAa,EAE5CT,EAAY,kBAAkB,CAChC,EAEMmB,EAA8Bd,EAClC,IAAe,CAACP,EAAM,MAAM,cAAgBA,EAAM,MAAM,cAAc,MACxE,EAEMsB,EAAoBf,EAAS,IAAM,OAChC,QAAAgB,EAAAvB,EAAM,QAAN,YAAAuB,EAAa,mBAAoB,EAAA,CACzC"}