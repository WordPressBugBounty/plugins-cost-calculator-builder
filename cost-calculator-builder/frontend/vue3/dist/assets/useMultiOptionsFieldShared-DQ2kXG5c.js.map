{"version":3,"file":"useMultiOptionsFieldShared-DQ2kXG5c.js","sources":["../../src/widget/actions/fields/composable/useMultiOptionsFieldShared.ts"],"sourcesContent":["import { computed, ref, toRefs } from \"vue\";\nimport { IMultiOptionsField, IOptions } from \"@/widget/shared/types/fields\";\nimport { useFieldsStore } from \"@/widget/app/providers/stores/fieldsStore.ts\";\nimport { useSingleField } from \"@/widget/actions/fields/composable/useSingleField.ts\";\nimport { useConditionsStore } from \"@/widget/app/providers/stores/conditionsStore.ts\";\nimport { usePageBreakerStore } from \"@/widget/app/providers/stores/pageBreakerStore.ts\";\nimport { useSettingsStore } from \"@/widget/app/providers/stores/settingsStore\";\n\nexport function useMultiOptionsFieldShared(props: {\n  field: IMultiOptionsField;\n}) {\n  const { field } = toRefs(props);\n  const conditionsStore = useConditionsStore();\n  const pageBreakerStore = usePageBreakerStore();\n  const fieldStore = useFieldsStore();\n  const singleFieldInstance = useSingleField();\n\n  const style = ref<string>(\"default\");\n  const selectedOptions = ref<IOptions[]>([]);\n\n  const isRequired = computed(() => fieldStore.checkFieldRequired(field.value));\n  const fieldSelectedOption = computed(() => field.value.selectedOption || []);\n\n  const fieldValue = computed(() =>\n    fieldSelectedOption.value?.map((f: IOptions) => f.optionValue),\n  );\n\n  const getKey = computed(() => {\n    return (\n      fieldValue.value\n        ?.map((optionValue: string) => {\n          return optionValue.split(\"_\")[1] || 9999;\n        })\n        .join(\"_\") || 9999\n    );\n  });\n\n  const updateValue = (options: IOptions[]) => {\n    field.value.selectedOption = options;\n\n    let value = 0;\n    if (Array.isArray(options)) {\n      for (const option of options) {\n        let splitValues: string[] = option.optionValue?.toString()?.split(\"_\");\n        const originalValue: number = +splitValues[0];\n\n        if (\n          !isNaN(originalValue) &&\n          field.value.summaryView !== \"show_label_not_calculable\"\n        ) {\n          value += originalValue;\n        }\n      }\n    }\n\n    field.value.value = value;\n    field.value.displayValue =\n      singleFieldInstance.getMultipleOptionsFieldDisplayView(field.value);\n\n    fieldStore.updateField(field.value.alias, field.value);\n    conditionsStore.applyConditionForField(field.value.alias);\n\n    if (\n      fieldStore.getPageBreakEnabled &&\n      fieldStore.getActivePage.action === \"not_skip\"\n    ) {\n      pageBreakerStore.checkPageFieldsConditions();\n    }\n  };\n\n  const applyChanges = (value: string): void => {\n    selectedOptions.value = [];\n    const values = value.split(\",\");\n\n    for (const v of values) {\n      const option = field.value.options.find(\n        (f: IOptions) => f.optionValue === v,\n      );\n\n      if (option) {\n        selectedOptions.value.push(option);\n      }\n    }\n\n    updateValue(selectedOptions.value);\n  };\n\n  const requiredWarningText = computed(() => {\n    const settingStore = useSettingsStore();\n    return settingStore.getWarningTexts?.requiredMsg || \"\";\n  });\n\n  return {\n    style,\n    selectedOptions,\n    updateValue,\n    applyChanges,\n    isRequired,\n    fieldValue,\n    getKey,\n    requiredWarningText,\n  };\n}\n"],"names":["useMultiOptionsFieldShared","props","field","toRefs","conditionsStore","useConditionsStore","pageBreakerStore","usePageBreakerStore","fieldStore","useFieldsStore","singleFieldInstance","useSingleField","style","ref","selectedOptions","isRequired","computed","fieldSelectedOption","fieldValue","_a","f","getKey","optionValue","updateValue","options","value","option","originalValue","_b","applyChanges","values","v","requiredWarningText","useSettingsStore"],"mappings":"sJAQO,SAASA,EAA2BC,EAExC,CACD,KAAM,CAAE,MAAAC,CAAA,EAAUC,EAAOF,CAAK,EACxBG,EAAkBC,EAAmB,EACrCC,EAAmBC,EAAoB,EACvCC,EAAaC,EAAe,EAC5BC,EAAsBC,EAAe,EAErCC,EAAQC,EAAY,SAAS,EAC7BC,EAAkBD,EAAgB,EAAE,EAEpCE,EAAaC,EAAS,IAAMR,EAAW,mBAAmBN,EAAM,KAAK,CAAC,EACtEe,EAAsBD,EAAS,IAAMd,EAAM,MAAM,gBAAkB,EAAE,EAErEgB,EAAaF,EAAS,IAC1B,OAAA,OAAAG,EAAAF,EAAoB,QAApB,YAAAE,EAA2B,IAAKC,GAAgBA,EAAE,aACpD,EAEMC,EAASL,EAAS,IAAM,OAC5B,QACEG,EAAAD,EAAW,QAAX,YAAAC,EACI,IAAKG,GACEA,EAAY,MAAM,GAAG,EAAE,CAAC,GAAK,MAErC,KAAK,OAAQ,IAAA,CAEnB,EAEKC,EAAeC,GAAwB,SAC3CtB,EAAM,MAAM,eAAiBsB,EAE7B,IAAIC,EAAQ,EACR,GAAA,MAAM,QAAQD,CAAO,EACvB,UAAWE,KAAUF,EAAS,CAEtB,MAAAG,EAAwB,GADFC,GAAAT,EAAAO,EAAO,cAAP,YAAAP,EAAoB,aAApB,YAAAS,EAAgC,MAAM,MACvB,CAAC,EAG1C,CAAC,MAAMD,CAAa,GACpBzB,EAAM,MAAM,cAAgB,8BAEnBuB,GAAAE,EACX,CAIJzB,EAAM,MAAM,MAAQuB,EACpBvB,EAAM,MAAM,aACVQ,EAAoB,mCAAmCR,EAAM,KAAK,EAEpEM,EAAW,YAAYN,EAAM,MAAM,MAAOA,EAAM,KAAK,EACrCE,EAAA,uBAAuBF,EAAM,MAAM,KAAK,EAGtDM,EAAW,qBACXA,EAAW,cAAc,SAAW,YAEpCF,EAAiB,0BAA0B,CAE/C,EAEMuB,EAAgBJ,GAAwB,CAC5CX,EAAgB,MAAQ,CAAC,EACnB,MAAAgB,EAASL,EAAM,MAAM,GAAG,EAE9B,UAAWM,KAAKD,EAAQ,CAChB,MAAAJ,EAASxB,EAAM,MAAM,QAAQ,KAChCkB,GAAgBA,EAAE,cAAgBW,CACrC,EAEIL,GACcZ,EAAA,MAAM,KAAKY,CAAM,CACnC,CAGFH,EAAYT,EAAgB,KAAK,CACnC,EAEMkB,EAAsBhB,EAAS,IAAM,OAElC,QAAAG,EADcc,EAAiB,EAClB,kBAAb,YAAAd,EAA8B,cAAe,EAAA,CACrD,EAEM,MAAA,CACL,MAAAP,EACA,gBAAAE,EACA,YAAAS,EACA,aAAAM,EACA,WAAAd,EACA,WAAAG,EACA,OAAAG,EACA,oBAAAW,CACF,CACF"}