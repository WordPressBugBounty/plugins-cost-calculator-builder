import{d as fe,B as _e,e as y,k as he,f as L,c as B,o as A,l as n,a as S,L as p,u as i,N as E,F as ye,w as Z,O as ee,E as we}from"./runtime-dom.esm-bundler-q8x4SZ5d.js";import{_ as O,b as Ce}from"./ThankYouPage-VtHWX-ye.js";import{n as Le,f as Ne,o as be,p as ke,i as Fe,k as xe}from"./widget-G8qGMCyR.js";import{L as Te,u as Se}from"./index-CKR6bjwQ.js";import{u as Me}from"./translationsStore-C4wu_Y0X.js";import"./jquery-C7OTzgKr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const De={class:"ccb-user-location"},Ie={class:"ccb-user-location__input-wrapper"},Pe={class:"label"},Ve={class:"ccb-user-location__description"},$e={key:0},Be={key:1,class:"ccb-user-location__adressname"},Ae={class:"ccb-location-modal"},Ee={class:"ccb-location-modal__body"},Oe={class:"ccb-location-modal__sidebar"},Ge={class:"ccb-location-modal__inputs"},Re={class:"ccb-location-modal__input"},Ke={for:"latitude"},qe=["id","placeholder"],Ue={class:"ccb-location-modal__input"},je={for:"longitude"},ze=["id","placeholder"],He={class:"ccb-location-modal__distance"},Je=["id"],Qe={class:"ccb-location-modal__footer"},to=fe({__name:"TwoPoints",props:{field:{}},setup(oe){const k=Fe(),G=xe(),ae=oe,{field:t}=_e(ae),te=be(),R=Le(),K=Ne(),q=ke(),d=Me(),M=y(),{getGoogleApiKey:se,mapOptions:ne,generateId:le,getMeasure:F,getMarkerIconPath:U,calculateValueByEachCost:ie,eachCost:re,generateGoogleLink:j}=Se();let N=le(4),z=y({lat:51.554867,lng:-.109112}),e=y({from:{addressName:"",coordinates:{lat:0,lng:0}},to:{addressName:"",coordinates:{lat:0,lng:0}}}),g=y(""),w=y("from"),f=y(null),m=y({from:null,to:null});const ce=new Te({apiKey:se(),version:"weekly",libraries:["places","geometry"]});he(()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(o=>{const a=o.coords.latitude,s=o.coords.longitude;let l={lat:a,lng:s};z.value=l,D()},()=>{D()}):D()});let x;const D=()=>{ce.load().then(async()=>{const{Map:o}=await google.maps.importLibrary("maps");x=new o(document.getElementById(N),{...ne(),mapId:N,center:{...z.value}});const a=document.getElementById(V.value),s=document.getElementById($.value),l=new google.maps.places.SearchBox(a),r=new google.maps.places.SearchBox(s);l.addListener("places_changed",()=>{J(l,"from")}),r.addListener("places_changed",()=>{J(r,"to")}),google.maps.event.addListener(x,"click",c=>{if(w){const v={lat:c.latLng?c.latLng.lat():0,lng:c.latLng?c.latLng.lng():0};e.value[w.value].coordinates=v,ve(w.value,v);const _=w.value==="from"?V.value:$.value;new google.maps.Geocoder().geocode({location:c.latLng},(u,T)=>{var C;if(T==="OK"&&u&&u.length>0){const b=u[0].formatted_address;(C=document.getElementById(_))==null||C.setAttribute("value",b),e.value[w.value].addressName=b,e.value.from.coordinates&&e.value.to.coordinates&&Q()}else console.error("Geocoding failed:",T)})}})})},de=()=>{P.value&&ue()},ue=()=>{t.value.value=parseFloat(ie(parseFloat(g.value),Y.value).toFixed(2)),t.value.displayValue=ge.value,t.value.extraDisplayView=[`From: ${e.value.from.addressName.length>30?e.value.from.addressName.slice(0,30)+"...":e.value.from.addressName}`,`To: ${e.value.to.addressName.length>34?e.value.to.addressName.slice(0,34)+"...":e.value.to.addressName}`,`${X.value}`];const o={distance:g.value,distance_view:X.value,measure:F(),eachCost:t.value.eachCost,twoPoints:{from:{addressName:e.value.from.addressName,coordinates:e.value.from.coordinates,addressLink:j(e.value.from.coordinates)},to:{addressName:e.value.to.addressName,coordinates:e.value.to.coordinates,addressLink:j(e.value.to.coordinates)}}};t.value.userSelectedOptions=o,K.updateField(t.value.alias,t.value),R.applyConditionForField(t.value.alias),k.getPageBreakEnabled()&&k.getActivePage().action==="not_skip"&&G.checkPageFieldsConditions(),I()},H=o=>{w.value=o},me=()=>{t.value.userSelectedOptions={},Object.values(m.value).forEach(o=>{o&&(o.map=null)}),m.value.from=null,m.value.to=null,f.value!==null&&f.value.setMap(null),g.value="0",e.value={from:{addressName:"",coordinates:{lat:0,lng:0}},to:{addressName:"",coordinates:{lat:0,lng:0}}},t.value.value=0,t.value.displayValue="",t.value.extraDisplayView=[],K.updateField(t.value.alias,t.value),R.applyConditionForField(t.value.alias),k.getPageBreakEnabled()&&k.getActivePage().action==="not_skip"&&G.checkPageFieldsConditions(),I()},ve=async(o,a)=>{o==="from"&&m.value.from?(m.value.from.map=null,m.value.from=null):o==="to"&&m.value.to&&(m.value.to.map=null,m.value.to=null);const s=document.createElement("img");s.style.width="40px",s.style.height="40px",s.src=U();const{AdvancedMarkerElement:l}=await google.maps.importLibrary("marker"),r=new l({position:a,map:x});U()&&(r.content=s),o==="from"?m.value.from=r:m.value.to=r},J=(o,a)=>{var v,_,h,u;const s=o.getPlaces()||[];if(!Array.isArray(s)||(s==null?void 0:s.length)===0)return;const l=s[0],r={lat:((_=(v=l==null?void 0:l.geometry)==null?void 0:v.location)==null?void 0:_.lat())||0,lng:((u=(h=l==null?void 0:l.geometry)==null?void 0:h.location)==null?void 0:u.lng())||0},c=l.formatted_address;e.value[a].coordinates={lat:r.lat,lng:r.lng},e.value[a].addressName=c||"",e.value.from.coordinates&&e.value.to.coordinates&&Q()},Q=async()=>{try{const o=await W();g.value=o,f.value&&(f.value.setMap(null),f.value=null);const a=new google.maps.DirectionsService;f.value=new google.maps.DirectionsRenderer({suppressMarkers:!0}),f.value&&f.value.setMap(x);const s=[{location:e.value.from.coordinates,stopover:!0},{location:e.value.to.coordinates,stopover:!0}],l=new google.maps.LatLng(e.value.from.coordinates),r=new google.maps.LatLng(e.value.to.coordinates),c={origin:l,destination:r,waypoints:s,travelMode:google.maps.TravelMode.DRIVING};a.route(c,(v,_)=>{var h;_==="OK"&&((h=f.value)==null||h.setDirections(v),W().then(u=>{g.value=u}))})}catch(o){throw o}},W=()=>{const o=new google.maps.DirectionsService,a=[{location:new google.maps.LatLng(e.value.from.coordinates.lat,e.value.from.coordinates.lng),stopover:!0},{location:new google.maps.LatLng(e.value.to.coordinates.lat,e.value.to.coordinates.lng),stopover:!0}],s={origin:new google.maps.LatLng(e.value.from.coordinates.lat,e.value.from.coordinates.lng),destination:new google.maps.LatLng(e.value.to.coordinates.lat,e.value.to.coordinates.lng),waypoints:a,travelMode:google.maps.TravelMode.DRIVING};return new Promise(l=>{o.route(s,(r,c)=>{var v,_;if(c==="OK"){const h=((_=(v=r==null?void 0:r.routes[0])==null?void 0:v.legs)==null?void 0:_.reduce((T,C)=>{var b;return T+(((b=C==null?void 0:C.distance)==null?void 0:b.value)||0)},0))||0;let u;F()==="miles"?u=(h*621371e-9).toFixed(2):u=(h*.001).toFixed(2),l(u)}})})},pe=()=>{M.value.showPopup()},I=()=>{M.value.hidePopup()},ge=L(()=>{var o;return t.value.useCurrency?te.getCommonFieldDisplayView(t.value):((o=t.value.value)==null?void 0:o.toString())||""}),X=L(()=>{const o=q.getCurrencyOptions(t.value),a=o.currency,s=o.currencyPosition;let l=0;t.value.value&&(l=re(parseFloat(g.value),Y.value));const r=q.parseCurrencyPosition(l.toString(),a,s||"left");let c=t.value.useCurrency?`${r}`:l;return`Distance: ${g.value} ${F()} x ${c}`}),P=L(()=>e.value.from.addressName&&e.value.to.addressName&&g.value),Y=L(()=>{var o;return{value:{pricingType:t.value.pricingType,eachCost:String(t.value.eachCost),distanceCostList:t.value.distanceCostList.map(a=>({from:a.from,to:a.to,cost:String(a.cost)})),lastDistanceCost:{cost:String(((o=t.value.lastDistanceCost)==null?void 0:o.cost)||"0")}}}}),V=L(()=>`${t.value.alias}-locationFrom-${N}`),$=L(()=>`${t.value.alias}-locationTo-${N}`);return(o,a)=>(A(),B("div",De,[n("div",Ie,[n("button",{class:"ccb-user-location__action",onClick:pe},[a[4]||(a[4]=n("span",{class:"icon"},[n("i",{class:"ccb-icon-location"})],-1)),n("span",Pe,p(i(d).getTranslations.openMap),1)]),n("div",Ve,[P.value?(A(),B("span",Be,[n("span",null,p(i(d).getTranslations.from)+":",1),E(" "+p(i(e).from.addressName)+" ",1),a[5]||(a[5]=n("br",null,null,-1)),n("span",null,p(i(d).getTranslations.to)+":",1),E(" "+p(i(e).to.addressName),1)])):(A(),B("span",$e,p(i(d).getTranslations.chooseFromMap),1))])]),S(Ce,{ref_key:"popup",ref:M},{default:ye(()=>[n("div",Ae,[n("div",Ee,[n("div",Oe,[n("div",Ge,[n("div",Re,[n("label",Ke,p(i(d).getTranslations.from),1),Z(n("input",{id:V.value,type:"text",placeholder:i(d).getTranslations.enterAddress,"onUpdate:modelValue":a[0]||(a[0]=s=>i(e).from.addressName=s),onClick:a[1]||(a[1]=s=>H("from"))},null,8,qe),[[ee,i(e).from.addressName]])]),n("div",Ue,[n("label",je,p(i(d).getTranslations.toDestination),1),Z(n("input",{id:$.value,"onUpdate:modelValue":a[2]||(a[2]=s=>i(e).to.addressName=s),type:"text",placeholder:i(d).getTranslations.enterAddress,onClick:a[3]||(a[3]=s=>H("to"))},null,8,ze),[[ee,i(e).to.addressName]])])]),n("div",He,[E(p(i(d).getTranslations.distance)+": ",1),n("span",null,p(`${i(g)} ${i(F)()}`),1)])]),n("div",{id:i(N),class:"ccb-location-modal__map"},null,8,Je)]),n("div",Qe,[S(O,{type:"light",text:i(d).getTranslations.clearLocation,class:we(["clear",{disable:!P.value}]),onClick:me},null,8,["text","class"]),S(O,{type:"light",text:i(d).getTranslations.cancel,onClick:I},null,8,["text"]),S(O,{type:"success",text:i(d).getTranslations.saveLocation,onClick:de},null,8,["text"])])])]),_:1},512)]))}});export{to as default};
//# sourceMappingURL=TwoPoints-0zbIKaYx.js.map
