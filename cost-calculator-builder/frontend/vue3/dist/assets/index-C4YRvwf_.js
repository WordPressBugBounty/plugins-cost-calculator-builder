import{a as ne,C as oe,k as b,o as ue,b as m,m as d,g as n,p as o,q as v,F as E,f as x,u as s,L as T,n as z,D as f,w as re,I as $,O as ce,U as de,H as pe}from"./convert-case-to-camel-case.utils-DRsbC-qG.js";import{u as ve,c as fe,n as _e,a as me,l as ge,o as he}from"./widget-DTyF7X6W.js";import{u as ye}from"./translationsStore-C34buciO.js";import{H as Fe}from"./Hint-CnHJZ--4.js";import{_ as A}from"./RequiredHint.vue_vue_type_style_index_0_lang-DFYyucnB.js";import{c as be,a as P}from"./ThankYouPage-COolTCjK.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BZCOha1n.js";const xe={class:"ccb-field__label"},ke={class:"ccb-field__title"},we={key:0,class:"ccb-field-required-mark"},Ce={key:0,class:"ccb-field__descriptions ccb-before"},Se={key:0,class:"ccb-field__description"},Ue={class:"ccb-file-upload__buttons"},Te={key:1,class:"ccb-file-upload__upload-url"},$e={class:"ccb-field__input-wrapper"},Ae=["placeholder"],Ve={key:2},qe={key:1,class:"ccb-file-upload__files"},ze={class:"name"},Ie=["onClick"],Me={key:3,class:"ccb-field__descriptions ccb-after"},Be={key:0,class:"ccb-field__description"},De=["accept","multiple"],Je=ne({__name:"FileUpload",props:{field:{},files:{}},setup(L){const N=L,{field:e,files:k}=oe(N),I=ve(),R=he(),M=fe(),O=_e(),B=ge(),g=ye(),h=b(null),i=b([]),y=b(""),w=b(!1),u=b(""),V=b(!1);ue(()=>{W()});const W=()=>{e.value.files&&e.value.files.forEach(t=>{let l=new File([t],t.name,{type:t.type});i.value.push(l)}),C()},H=()=>u.value="",j=m(()=>{var l;return((l=me().getWarningTexts)==null?void 0:l.requiredMsg)||""}),G=m(()=>e.value.maxAttachedFiles||1),J=m(()=>e.value.maxFileSize||1),K=t=>{u.value="";const l=t.target;let a=[...i.value];if(Array.from((l==null?void 0:l.files)||[]).forEach(r=>{let c=r.name,p="",F=c.lastIndexOf(".");F!==-1&&(p=c.slice(F),c=c.slice(0,F));let U=a.filter(ie=>ie.name.startsWith(c)).length;U>0&&(c=`${c}(${U})`);let se=new File([r],c+p,{type:r.type});a.push(se)}),a=a.filter(r=>D(r)),e.value.maxAttachedFiles<a.length){let r=a.length-e.value.maxAttachedFiles;a.splice(a.length-r,r)}i.value=a,C()},Q=t=>{u.value="",i.value.splice(t,1),h.value&&"value"in h.value&&(h.value.value=""),C()},X=()=>{var a,_,r,c;let t=[...i.value];if(e.value.maxAttachedFiles<t.length+1)return;let l=((c=(r=(_=(a=y.value)==null?void 0:a.split("/"))==null?void 0:_.pop())==null?void 0:r.split("#")[0])==null?void 0:c.split("?")[0])||"";fetch(y.value).then(async p=>p.ok?p.blob():(u.value="upload_url",!1)).then(p=>{if(p&&typeof p!="boolean"&&u.value!=="upload_url"){if(l.lastIndexOf(".")===-1){let U=p.type.split("/")[1].toLowerCase();l=l+"."+U}let F=new File([p],l,{type:p.type});D(F)&&i.value.push(F),C()}}).catch(()=>{u.value="upload_url"}),y.value=""},D=t=>{var _,r,c;let l=Number((t.size/1048576).toFixed(2));if(e.value.maxFileSize<l)return u.value="big_file_size",!1;const a=((c=(r=(_=t==null?void 0:t.name)==null?void 0:_.split("."))==null?void 0:r.pop())==null?void 0:c.toLowerCase())||"";return q.value.includes(a)?!0:(u.value="wrong_format",!1)},Y=()=>{S.value||(w.value=!w.value,y.value="")},Z=()=>{var t;S.value||(w.value=!1,(t=h==null?void 0:h.value)==null||t.click())},C=()=>{var l,a;i.value.length===0&&((l=k==null?void 0:k.value)==null?void 0:l.length)!==0&&(i.value=k.value||[]);let t=i.value.length>0?e.value.price:0;e.value.allowPrice&&e.value.calculatePerEach&&(t=e.value.price*i.value.length),e.value.value=t,e.value.files=i.value||[],e.value.displayValue=((a=te.value)==null?void 0:a.toString())||"",e.value.extraDisplayView=le.value,typeof e.value.repeaterIdx<"u"&&(window.ccb_rep_files||(window.ccb_rep_files={}),window.ccb_rep_files[`${e.value.alias}_${e.value.repeaterIdx}`]=i.value),M.updateField(e.value.alias,e.value),O.applyConditionForField(e.value.alias)},q=m(()=>{const t=[];return e.value.fileFormats.forEach(l=>t.push.apply(t,l.split("/"))),t}),ee=m(()=>M.checkFieldRequired(e.value)?(u.value="required",!0):(u.value="",!1)),le=m(()=>{if(!e.value.allowPrice)return"";if(e.value.calculatePerEach){const t=B.formatCurrency(e.value.price,B.getCurrencyOptions(e.value)),l=e.value.useCurrency?t:e.value.price;return`${i.value.length} file(s) x ${l}`}return`${i.value.length} file(s)`}),te=m(()=>{var t;return e.value.allowPrice?e.value.useCurrency||e.value.fieldCurrency?R.getCommonFieldDisplayView(e.value):((t=e.value.value)==null?void 0:t.toString())||"":`${i.value.length} file(s)`}),S=m(()=>e.value.maxAttachedFiles<=i.value.length),ae=m(()=>{var t;return((t=e.value)==null?void 0:t.additionalStyles)||""});return(t,l)=>(n(),d("div",{class:$(["ccb-field ccb-file-upload",{required:ee.value,"ccb-field-disabled":s(e).disabled,[ae.value]:!0}])},[o("div",xe,[u.value!==""?(n(),d(E,{key:0},[u.value==="big_file_size"?(n(),x(s(A),{key:0,text:s(g).getTranslations.bigFileSize},null,8,["text"])):u.value==="wrong_format"?(n(),x(s(A),{key:1,text:s(g).getTranslations.wrongFileFormat},null,8,["text"])):u.value==="upload_url"?(n(),x(s(A),{key:2,text:s(g).getTranslations.wrongFileUrl},null,8,["text"])):(n(),x(s(A),{key:3,text:j.value},null,8,["text"]))],64)):v("",!0),o("div",ke,[T(f(s(e).label),1),s(e).required?(n(),d("span",we,"*")):v("",!0),z(be),z(s(Fe),null,{content:re(()=>[T(" Supported file types: "+f(q.value.map(a=>`.${a}`).join(", "))+" ",1),l[2]||(l[2]=o("br",null,null,-1)),T(" File size: "+f(J.value)+" MB ",1),l[3]||(l[3]=o("br",null,null,-1)),T(" Max "+f(G.value)+" files ",1)]),_:1})])]),s(I).getAppearanceDescriptionPosition==="before"?(n(),d("div",Ce,[s(e).description?(n(),d("div",Se,f(s(e).description),1)):v("",!0)])):v("",!0),l[5]||(l[5]=o("div",{class:"ccb-file-upload__input"},[o("input",{type:"file"})],-1)),o("div",Ue,[z(s(P),{type:"success",class:$({"ccb-btn-disableWrong file formatd":S.value}),onClick:Z,text:s(g).getTranslations.chooseFile},null,8,["class","text"]),s(e).uploadFromUrl?(n(),x(s(P),{key:0,type:"light",text:"Upload from URL",class:$({"ccb-btn-disabled":S.value}),onClick:Y},null,8,["class"])):v("",!0)]),w.value?(n(),d("div",Te,[o("div",$e,[ce(o("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),type:"text",placeholder:s(g).getTranslations.enterFileUrl,onInput:H},null,40,Ae),[[de,y.value]])]),o("div",null,[o("button",{class:$(["upload",{"ccb-btn-disabled":!y.value.length}]),onClick:X},f(s(g).getTranslations.upload),3)])])):v("",!0),i.value.length>0?(n(),d("div",Ve,[i.value.length>3?(n(),d("div",{key:0,class:"ccb-file-upload__file-list",onClick:l[1]||(l[1]=a=>V.value=!V.value)},[o("span",null,f(i.value.length)+" "+f(s(g).getTranslations.filesUploaded),1)])):v("",!0),i.value.length<=3||V.value?(n(),d("div",qe,[(n(!0),d(E,null,pe(i.value,(a,_)=>(n(),d("div",{key:_,class:"ccb-file-upload__file"},[o("span",ze,f(a.name),1),o("span",{class:"action",onClick:()=>Q(_)},l[4]||(l[4]=[o("i",{class:"ccb-icon-close"},null,-1)]),8,Ie)]))),128))])):v("",!0)])):v("",!0),s(I).getAppearanceDescriptionPosition==="after"?(n(),d("div",Me,[s(e).description?(n(),d("div",Be,f(s(e).description),1)):v("",!0)])):v("",!0),o("input",{ref_key:"fileElement",ref:h,style:{display:"none"},type:"file",accept:q.value.map(a=>`.${a}`).join(","),multiple:(s(e).maxAttachedFiles||1)>1,onChange:K},null,40,De)],2))}});export{Je as default};
//# sourceMappingURL=index-C4YRvwf_.js.map
