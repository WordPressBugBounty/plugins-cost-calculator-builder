{"version":3,"file":"index-17ijc0MP.js","sources":["../../src/widget/features/calculator-fields/components/DatePicker/DatePicker.vue"],"sourcesContent":["<template>\n  <div\n    class=\"ccb-field ccb-datePicker\"\n    :class=\"{\n      required: isRequired,\n      'ccb-field-disabled': field.disabled,\n      [additionalClasses]: true,\n    }\"\n  >\n    <div class=\"ccb-field__label\">\n      <RequiredHint v-if=\"isRequired\" :text=\"requiredWarningText\" />\n      <div class=\"ccb-field__title\">\n        {{ field.label\n        }}<span v-if=\"field.required\" class=\"ccb-field-required-mark\">*</span\n        ><ProBadge />\n      </div>\n    </div>\n\n    <div\n      v-if=\"appearanceStore.descriptionPosition === 'before'\"\n      class=\"ccb-field__descriptions ccb-before\"\n    >\n      <div v-if=\"field.description\" class=\"ccb-field__description\">\n        {{ field.description }}\n      </div>\n    </div>\n\n    <div class=\"ccb-field__input-wrapper\">\n      <VueDatePicker\n        v-model=\"date\"\n        :locale=\"currentLang\"\n        :auto-apply=\"field.autoCloseEnabled\"\n        :range=\"field.range\"\n        :placeholder=\"getPlaceholder\"\n        :enable-time-picker=\"false\"\n        :disabled-week-days=\"getDisabledWeekDays\"\n        :disabled-dates=\"getTotalDisableDate\"\n        :min-date=\"getMinDate\"\n        :format=\"format\"\n        :select-text=\"translationsStore.getTranslations.select\"\n        :cancel-text=\"translationsStore.getTranslations.cancel\"\n        @update:model-value=\"updateValue\"\n      />\n    </div>\n\n    <div\n      v-if=\"appearanceStore.descriptionPosition === 'after'\"\n      class=\"ccb-field__descriptions ccb-after\"\n    >\n      <div v-if=\"field.description\" class=\"ccb-field__description\">\n        {{ field.description }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { toRefs, computed } from \"vue\";\nimport VueDatePicker from \"@vuepic/vue-datepicker\";\nimport \"@vuepic/vue-datepicker/dist/main.css\";\n\nimport { useAppearanceStore } from \"@/widget/app/providers/stores/appearanceStore.ts\";\nimport { IDatePickerField } from \"@/widget/shared/types/fields\";\nimport { useFieldsStore } from \"@/widget/app/providers/stores/fieldsStore.ts\";\nimport { useConditionsStore } from \"@/widget/app/providers/stores/conditionsStore.ts\";\nimport { useSingleField } from \"@/widget/actions/fields/composable/useSingleField.ts\";\nimport { useDatePickerFieldHelper } from \"@/widget/actions/fields/composable/useDatePickerFieldHelper.ts\";\nimport { useCallbackStore } from \"@/widget/app/providers/stores/callbackStore.ts\";\nimport ProBadge from \"@/widget/shared/ui/components/Pro-badge/ProBadge.vue\";\nimport RequiredHint from \"@/widget/shared/ui/components/Required-hint/RequiredHint.vue\";\nimport { useTranslationsStore } from \"@/widget/app/providers/stores/translationsStore\";\nimport { useSettingsStore } from \"@/widget/app/providers/stores/settingsStore.ts\";\n\ntype Props = {\n  field: IDatePickerField;\n};\n\nconst props = defineProps<Props>();\nconst { field } = toRefs(props);\n\nconst appearanceStore = useAppearanceStore();\nconst fieldStore = useFieldsStore();\nconst conditionsStore = useConditionsStore();\nconst singleFieldMixins = useSingleField();\nconst callbackStore = useCallbackStore();\nconst translationsStore = useTranslationsStore();\nconst settingStore = useSettingsStore();\n\nconst { parseDate, getDaysDifference, displayValueHelper } =\n  useDatePickerFieldHelper();\n\nconst requiredWarningText = computed(() => {\n  return settingStore.getWarningTexts?.requiredMsg || \"\";\n});\n\nconst currentLang = computed(() => {\n  return settingStore.getLanguage;\n});\n\nconst format = () => displayValueHelper(date.value, currentLang.value);\nconst date = computed({\n  get() {\n    return field.value.selectedDate;\n  },\n  set(value) {\n    field.value.selectedDate = value;\n  },\n});\n\nconst isRequired = computed(() => {\n  return fieldStore.checkFieldRequired(field.value);\n});\n\nconst getPlaceholder = computed(() => {\n  return field.value.placeholder\n    ? field.value.placeholder\n    : translationsStore.getTranslations.selectDate;\n});\n\nconst getDisabledWeekDays = computed(() => {\n  if (!field.value.isHaveUnselectable) return [];\n  return field.value.notAllowedWeekDays?.map((n) => (n === 7 ? 0 : n));\n});\n\nconst getDisabledDates = computed(() => {\n  const today = new Date();\n  let days: Date[] = [];\n\n  if (!field.value.isHaveUnselectable) return days;\n\n  for (let i = 1; i <= field.value.daysFromCurrent; i++) {\n    const nDay = new Date(today);\n    nDay.setDate(nDay.getDate() + i);\n    days.push(nDay);\n  }\n\n  if (field.value.notAllowedDates?.current) {\n    days.push(today);\n  }\n\n  return days;\n});\n\nconst getMinDate = computed(() => {\n  if (field.value.isHaveUnselectable && field.value.notAllowedDates?.allPast) {\n    return new Date();\n  }\n\n  return \"\";\n});\n\nconst getBlockPeriodDates = computed(() => {\n  const dates: Date[] = [];\n\n  if (!field.value.isHaveUnselectable) return dates;\n\n  const notAllowedDates = field.value.notAllowedDates;\n\n  if (\n    notAllowedDates &&\n    notAllowedDates.period &&\n    notAllowedDates.period.length\n  ) {\n    for (const period of notAllowedDates.period) {\n      const startDate = new Date(parseDate(period.start || \"\"));\n      const endDate = new Date(parseDate(period.end || \"\"));\n\n      for (\n        let d = new Date(startDate);\n        d <= endDate;\n        d.setDate(d.getDate() + 1)\n      ) {\n        dates.push(new Date(d));\n      }\n    }\n  }\n\n  return dates;\n});\n\nconst getTotalDisableDate = computed(() => {\n  return [...getBlockPeriodDates.value, ...getDisabledDates.value];\n});\n\nconst getDisplayValue = computed(() => {\n  if (!field.value.dayPriceEnabled) {\n    return displayValueHelper(date.value, currentLang.value);\n  }\n\n  return field.value.useCurrency || field.value.fieldCurrency\n    ? singleFieldMixins.getCommonFieldDisplayView(field.value)\n    : field.value.value?.toString() || \"\";\n});\n\nconst getExtraDisplayValue = computed(() => {\n  if (field.value.dayPriceEnabled) {\n    const result: string[] = [\n      displayValueHelper(date.value, currentLang.value),\n    ];\n    const value =\n      field.value.useCurrency || field.value.fieldCurrency\n        ? singleFieldMixins.getCommonFieldDisplayView(field.value)\n        : field.value.value?.toString();\n\n    if (field.value.range && Array.isArray(date.value)) {\n      const dayDiff = getDaysDifference(\n        date.value[0] as Date,\n        date.value[1] as Date,\n        field.value,\n        getTotalDisableDate.value,\n        getDisabledWeekDays.value,\n      );\n\n      if (dayDiff)\n        result.push(\n          `${dayDiff} ${translationsStore.getTranslations.days} x ${field.value.dayPrice}`,\n        );\n    } else if (date.value) {\n      result.push(`1 ${translationsStore.getTranslations.days} x ${value}`);\n    }\n\n    return result;\n  }\n\n  return [];\n});\n\nconst getValue = computed(() => {\n  if (!field.value.dayPriceEnabled) return 0;\n\n  if (Array.isArray(date.value)) {\n    const differentDays = getDaysDifference(\n      date.value[0],\n      date.value[1],\n      field.value,\n      getTotalDisableDate.value,\n      getDisabledWeekDays.value,\n    );\n    return differentDays * field.value.dayPrice;\n  }\n\n  let val: number = date.value ? 1 : 0;\n  return val * field.value.dayPrice;\n});\n\nconst updateValue = (\n  modelData: Date | Date[],\n  alias?: string,\n  fromCondition?: boolean,\n) => {\n  if (alias && alias !== field.value.alias) {\n    return;\n  }\n\n  field.value.selectedDate = modelData || undefined;\n  field.value.value = getValue.value;\n  field.value.displayValue = getDisplayValue.value;\n  field.value.extraDisplayView = getExtraDisplayValue.value;\n  fieldStore.updateField(field.value.alias, field.value, fromCondition);\n  conditionsStore.applyConditionForField(field.value.alias);\n};\n\nconst additionalClasses = computed(() => {\n  return field.value?.additionalStyles || \"\";\n});\n\ncallbackStore.add(\"updateDatePicker\", updateValue);\n</script>\n\n<style lang=\"scss\">\n.ccb-datePicker *:focus {\n  outline-width: 0;\n}\n\n.ccb-datePicker {\n  input {\n    padding: 12px var(--ccb-field-side-indent);\n    padding-left: max(30px, var(--ccb-field-side-indent)) !important;\n\n    @media only screen and (max-width: 480px) {\n      padding: 12px var(--ccb-mobile-field-side-indent);\n      padding-left: max(30px, var(--ccb-mobile-field-side-indent)) !important;\n    }\n\n    &.dp__input_focus {\n      border-color: var(--ccb-accent-color);\n    }\n\n    &::placeholder {\n      color: var(--ccb-text-color);\n    }\n  }\n\n  .dp__input_icon {\n    fill: var(--ccb-text-color);\n  }\n\n  .dp--menu-wrapper {\n    width: 100%;\n    left: 0 !important;\n    color: var(--ccb-text-color) !important;\n    max-width: 430px;\n  }\n\n  .dp__active_date {\n    background: var(--ccb-accent-color) !important;\n  }\n\n  .dp__arrow_bottom,\n  .dp__arrow_top {\n    border: none;\n    background-color: var(--ccb-fields-bg-color);\n  }\n\n  .dp__menu {\n    border: none;\n    box-shadow: 0 10px 30px 0 rgba(0, 0, 0, 0.25);\n    border-radius: 4px;\n  }\n\n  .dp__menu_inner {\n    background: var(--ccb-fields-bg-color);\n    border-radius: 4px;\n  }\n\n  .dp__overlay_action {\n    background: var(--ccb-fields-bg-color);\n\n    &:hover {\n      background: var(--ccb-accent-color);\n      color: var(--ccb-text-color);\n    }\n  }\n\n  .dp__overlay {\n    background: var(--ccb-fields-bg-color);\n    color: var(--ccb-text-color);\n\n    .dp__overlay_cell {\n      &:hover {\n        background: color-mix(\n          in srgb,\n          var(--ccb-accent-color),\n          transparent 50%\n        );\n        color: var(--ccb-text-color);\n      }\n    }\n  }\n\n  .dp__overlay_cell_active {\n    background: var(--ccb-accent-color);\n    color: var(--ccb-text-color);\n  }\n\n  .dp__action_row {\n    background: var(--ccb-fields-bg-color);\n\n    .dp__action_cancel {\n      padding: 10px;\n      margin: 0;\n      border: none;\n      flex: 1;\n      border-radius: var(--ccb-fields-border-radius);\n      cursor: pointer;\n      transition: 300ms ease;\n      font-size: var(--ccb-fields-button-size);\n      font-weight: var(--ccb-fields-button-weight);\n      border: 1px solid var(--ccb-fields-border-color);\n      margin-right: 10px;\n      background: var(--ccb-date-picker-day);\n      color: var(--ccb-text-color);\n\n      @media only screen and (max-width: 480px) {\n        font-size: var(--ccb-mobile-fields-button-size);\n        font-weight: var(--ccb-mobile-fields-button-weight);\n      }\n\n      &:hover {\n        background: color-mix(\n          in srgb,\n          var(--ccb-accent-color),\n          transparent 50%\n        );\n      }\n    }\n\n    .dp__action_select {\n      padding: 10px;\n      margin: 0;\n      border: none;\n      flex: 1;\n      border-radius: var(--ccb-fields-border-radius);\n      cursor: pointer;\n      transition: 300ms ease;\n      font-size: var(--ccb-fields-button-size);\n      font-weight: var(--ccb-fields-button-weight);\n      background: var(--ccb-accent-color);\n      color: var(--ccb-fields-bg-color);\n\n      @media only screen and (max-width: 480px) {\n        font-size: var(--ccb-mobile-fields-button-size);\n        font-weight: var(--ccb-mobile-fields-button-weight);\n      }\n\n      &:hover {\n        background: hsl(from var(--ccb-accent-color) h s calc(l - 5));\n      }\n    }\n  }\n\n  .dp__menu-inner {\n    padding: 10px;\n  }\n\n  .dp__pointer {\n    background: var(--ccb-fields-bg-color);\n  }\n\n  .dp__inner_nav {\n    background: var(--ccb-date-picker-day);\n    border-radius: 4px;\n  }\n\n  .dp__month_year_wrap {\n    gap: 4px;\n    .dp__month_year_select {\n      background: var(--ccb-date-picker-day);\n      border-radius: 4px;\n      height: 26px;\n      font-size: 14px;\n      font-weight: 700;\n\n      &:hover {\n        background: var(--ccb-accent-color) !important;\n      }\n    }\n  }\n\n  .dp__cell_inner {\n    width: auto !important;\n    border-radius: 0px;\n    font-size: 12px !important;\n    font-weight: 500;\n  }\n\n  .dp__range_start,\n  .dp__range_end {\n    background: var(--ccb-accent-color) !important;\n  }\n\n  .dp__range_between {\n    background: var(--ccb-date-picker-picket-day) !important;\n    color: var(--ccb-accent-color) !important;\n  }\n\n  .dp--arrow-btn-nav {\n    padding: 0px !important;\n\n    &:hover {\n      background: var(--ccb-accent-color) !important;\n    }\n  }\n\n  .dp__calendar_item,\n  .dp__calendar_header_item {\n    color: var(--ccb-text-color) !important;\n  }\n\n  .dp__calendar_header_item {\n    height: 22px;\n  }\n\n  .dp__calendar_item {\n    border: 2px solid transparent;\n    &:hover {\n      border: 2px solid var(--ccb-accent-color);\n      background: color-mix(in srgb, var(--ccb-accent-color), transparent 50%);\n      color: var(--ccb-text-color) !important;\n    }\n  }\n\n  .dp__date_hover {\n    &:hover {\n      color: var(--ccb-text-color) !important;\n    }\n  }\n\n  .dp__today {\n    border: none;\n  }\n\n  .dp__calendar_row {\n    margin: 0;\n  }\n\n  .dp__calendar_header_separator {\n    display: none;\n  }\n\n  .dp__calendar_header {\n    font-size: 12px;\n    font-weight: 500;\n    opacity: 0.3;\n  }\n}\n</style>\n"],"names":["props","__props","field","toRefs","appearanceStore","useAppearanceStore","fieldStore","useFieldsStore","conditionsStore","useConditionsStore","singleFieldMixins","useSingleField","callbackStore","useCallbackStore","translationsStore","useTranslationsStore","settingStore","useSettingsStore","parseDate","getDaysDifference","displayValueHelper","useDatePickerFieldHelper","requiredWarningText","computed","_a","currentLang","format","date","value","isRequired","getPlaceholder","getDisabledWeekDays","n","getDisabledDates","today","days","nDay","getMinDate","getBlockPeriodDates","dates","notAllowedDates","period","startDate","endDate","d","getTotalDisableDate","getDisplayValue","getExtraDisplayValue","result","dayDiff","getValue","updateValue","modelData","alias","fromCondition","additionalClasses"],"mappings":"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"}