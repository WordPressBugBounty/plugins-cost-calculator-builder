import{_ as M,b as ve}from"./ThankYouPage-BQZhcTRI.js";import{f as me,n as _e,j as ye,o as fe,p as he}from"./widget-EtDMYrRk.js";import{L as we,u as Ce}from"./index-BLZo9-w4.js";import{u as be}from"./translationsStore-Ca2Pe_Lt.js";import{a as ke,t as xe,l as m,b as _,o as Se,n as V,g as I,q as i,p as w,v as D,u as r,w as Fe,A as Be}from"./convert-case-to-camel-case.utils-C0gHQHtf.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./jquery-C7OTzgKr.js";const Pe={class:"ccb-user-location"},Me={class:"ccb-user-location__input-wrapper"},Ve={class:"label"},Ie={class:"ccb-user-location__description"},De={key:0},Ee={key:1,class:"ccb-user-location__adressname"},$e={class:"ccb-location-modal"},Te={class:"ccb-location-modal__body"},Ae=["id"],Ne={class:"ccb-location-modal__search"},Ge=["id","placeholder"],Ke={class:"ccb-location-modal__footer"},Oe=ke({__name:"UserLocation",props:{field:{}},setup(H){const J=H,{field:e}=xe(J),g=me(),E=_e(),Q=fe(),$=he(),p=be(),T=ye(),C=m(),{getGoogleApiKey:W,mapOptions:X,generateId:Y,parseLocationCoordinates:A,calculateValueByEachCost:N,getMeasure:b,eachCost:Z,getMarkerIconPath:G}=Ce(),ee=new we({apiKey:W(),version:"weekly",libraries:["places","geometry"]});let u=m({lat:51.554867,lng:-.109112}),k=m([]),c=m(""),y=Y(4),f=m(0),te=m(""),v;const x=_(()=>{var t;return{value:{pricingType:e.value.pricingType,eachCost:String(e.value.eachCost),distanceCostList:e.value.distanceCostList.map(o=>({from:o.from,to:o.to,cost:String(o.cost)})),lastDistanceCost:{cost:String(((t=e.value.lastDistanceCost)==null?void 0:t.cost)||"0")}}}}),S=_(()=>e.value.userLocation),oe=_(()=>c.value.length>40?`${c.value.slice(0,40)} + ...`:c.value),ae=_(()=>{var t;return e.value.useCurrency?Q.getCommonFieldDisplayView(e.value):((t=e.value.value)==null?void 0:t.toString())||""}),se=_(()=>{const t=$.getCurrencyOptions(e.value),o=t.currency,l=t.currencyPosition;let s=0;e.value.value&&(s=Z(f.value,x.value));const a=$.parseCurrencyPosition(s.toString(),o,l||"left");let n=e.value.useCurrency?`${a}`:s;return`${p.getTranslations.distance}: ${f.value} ${b()} x ${n}`}),K=_(()=>`${e.value.alias}-search-input-${y}`),F=()=>{ee.load().then(async()=>{const{Map:t}=await google.maps.importLibrary("maps");v=new t(document.getElementById(y),{...X(),mapId:y,center:{...u.value}});const o=document.getElementById(K.value),l=new google.maps.places.SearchBox(o);v.addListener("bounds_changed",()=>{l.setBounds(v.getBounds())}),l.addListener("places_changed",()=>{const s=l.getPlaces();if((s==null?void 0:s.length)===0)return;const a=new google.maps.LatLngBounds;s==null||s.forEach(n=>{if(!n.geometry||!n.geometry.location)return;const d={lat:n.geometry.location.lat(),lng:n.geometry.location.lng()};U(d),n.geometry.viewport?a.union(n.geometry.viewport):a.extend(n.geometry.location),c.value=n.formatted_address||"",u.value.lat=n.geometry.location.lat(),u.value.lng=n.geometry.location.lng()}),v.fitBounds(a)}),v.addListener("click",s=>{const a=s.latLng;U({lat:(a==null?void 0:a.lat())||0,lng:(a==null?void 0:a.lng())||0}),u.value.lat=(a==null?void 0:a.lat())||0,u.value.lng=(a==null?void 0:a.lng())||0,new google.maps.Geocoder().geocode({location:a},(d,h)=>{h==="OK"&&Array.isArray(d)&&d[0]&&(c.value=d[0].formatted_address,o.value=d[0].formatted_address)})})})},ne=()=>{c.value=""},ie=()=>{C.value.showPopup()},B=()=>{C.value.hidePopup()},O=()=>{k.value.forEach(t=>{t.map=null}),k.value=[]},U=async t=>{O();const o=document.createElement("img");o.style.width="40px",o.style.height="40px",o.src=G();const{AdvancedMarkerElement:l}=await google.maps.importLibrary("marker"),s=new l({position:t,map:v});G()&&(s.content=o),k.value.push(s)},le=()=>{if(c.value){ne();const t=document.getElementById(y);O(),t&&(t.value=""),ue(),B()}},ce=()=>{const t=new google.maps.DirectionsService,o=A(S.value.toString()),l=u.value,a={origin:o,destination:l,waypoints:[{location:o,stopover:!0},{location:l,stopover:!0}],travelMode:google.maps.TravelMode.DRIVING},n=b();return new Promise(d=>{t.route(a,(h,pe)=>{var q,R;if(pe==="OK"){const j=((R=(q=h==null?void 0:h.routes[0])==null?void 0:q.legs)==null?void 0:R.reduce((ge,P)=>{var z;return ge+(((z=P==null?void 0:P.distance)==null?void 0:z.value)||0)},0))||0;let L;n==="miles"?L=(j*621371e-9).toFixed(2):L=(j*.001).toFixed(2),d(L)}})})},re=async()=>{c.value&&(f.value=Number(await ce()),te.value=`${N(f.value,x.value)} ${b()}`,de(),B())},ue=()=>{e.value.value=0,e.value.displayValue="0",e.value.extraDisplayView=[],g.updateField(e.value.alias,e.value),E.applyConditionForField(e.value.alias),g.getPageBreakEnabled&&g.getActivePage.action==="not_skip"&&T.checkPageFieldsConditions()},de=()=>{e.value.value=parseFloat(N(f.value,x.value).toFixed(2))||0,e.value.displayValue=ae.value,e.value.extraDisplayView=[oe.value.toString(),se.value.toString()],g.updateField(e.value.alias,e.value),E.applyConditionForField(e.value.alias),g.getPageBreakEnabled&&g.getActivePage.action==="not_skip"&&T.checkPageFieldsConditions()};return Se(()=>{S.value&&(u.value=A(S.value.toString())),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(t=>{const o=t.coords.latitude,l=t.coords.longitude;u.value={lat:o,lng:l},F()},()=>{F()}):F()}),(t,o)=>(I(),V("div",Pe,[i("div",Me,[i("button",{class:"ccb-user-location__action",onClick:ie},[o[0]||(o[0]=i("span",{class:"icon"},[i("i",{class:"ccb-icon-location"})],-1)),i("span",Ve,D(r(p).getTranslations.openMap),1)]),i("div",Ie,[r(c)?(I(),V("span",Ee,D(r(c)),1)):(I(),V("span",De,D(r(p).getTranslations.chooseFromMap),1))])]),w(ve,{ref_key:"popup",ref:C},{default:Fe(()=>[i("div",$e,[i("div",Te,[i("div",{id:r(y),class:"ccb-location-modal__map"},null,8,Ae),i("div",Ne,[o[1]||(o[1]=i("i",{class:"ccb-icon-Search-Magnifier"},null,-1)),i("input",{id:K.value,class:"controls",type:"text",placeholder:r(p).getTranslations.searchLocation},null,8,Ge)])]),i("div",Ke,[w(M,{type:"light",text:r(p).getTranslations.clearLocation,class:Be(["clear",{disable:!r(c)}]),"on-click":le},null,8,["text","class"]),w(M,{type:"light",text:r(p).getTranslations.cancel,"on-click":B},null,8,["text"]),w(M,{type:"success",text:r(p).getTranslations.saveLocation,"on-click":re},null,8,["text"])])])]),_:1},512)]))}}),Qe=Le(Oe,[["__scopeId","data-v-aaa814d6"]]);export{Qe as default};
//# sourceMappingURL=UserLocation-CMSneq3x.js.map
