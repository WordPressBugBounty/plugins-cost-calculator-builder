{"version":3,"file":"RepeaterItem-CTqvQM1Y.js","sources":["../../src/widget/shared/ui/total-summary/items/RepeaterItem.vue"],"sourcesContent":["<template>\n  <div class=\"ccb-summary-repeater\">\n    <template v-for=\"(elements, idx) in summary.groupElements\">\n      <div\n        class=\"ccb-summary-repeater__header\"\n        @click=\"collapseStore[idx] = !collapseStore[idx]\"\n        v-if=\"getFieldsFromMap(elements).length > 0\"\n      >\n        <div class=\"ccb-summary-repeater__left\">\n          <div\n            class=\"ccb-summary-repeater__btn\"\n            :aria-expanded=\"!collapseStore[idx]\"\n            :class=\"{ rotated: collapseStore[idx] }\"\n          >\n            <i class=\"ccb-icon-Path-3514\"></i>\n          </div>\n          <div class=\"ccb-summary-repeater__title\">{{ summary.label }}</div>\n          <div class=\"ccb-summary-repeater__count\">#{{ idx + 1 }}</div>\n        </div>\n        <div class=\"ccb-summary-repeater__value\">\n          {{ getGroupTotal(elements) }}\n        </div>\n      </div>\n      <div\n        class=\"ccb-summary-repeater__list\"\n        :class=\"{ hidden: collapseStore[idx] }\"\n      >\n        <template\n          v-if=\"getFieldsFromMap(elements).length > 0\"\n          v-for=\"element in getFieldsFromMap(elements)\"\n        >\n          <Transition name=\"fade\">\n            <TotalSummaryItem\n              item-type=\"summary\"\n              :summary=\"element\"\n            ></TotalSummaryItem>\n          </Transition>\n        </template>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref, toRefs } from \"vue\";\nimport { Field, IRepeaterField } from \"@/widget/shared/types/fields\";\nimport TotalSummaryItem from \"@/widget/shared/ui/total-summary/TotalSummaryItem.vue\";\n\ntype Props = {\n  summary: IRepeaterField;\n};\n\nconst props = defineProps<Props>();\nconst { summary } = toRefs(props);\n\nconst collapseStore = ref<Record<number, boolean>>({});\n\nconst getFieldsFromMap = computed(() => {\n  return (data: Map<string, Field>): Field[] => {\n    return Array.from(data.values()).filter((item: Field) => item.addToSummary);\n  };\n});\n\nconst getGroupTotal = computed(() => {\n  return (data: Map<string, Field>): number => {\n    if (summary.value.enableFormula) {\n      // If formula mode is enabled for repeater, calculate per-group total by formula\n      const baseFormula =\n        (summary.value.originalFormula &&\n          summary.value.originalFormula.trim()) ||\n        (summary.value.formula && summary.value.formula.trim()) ||\n        \"0\";\n\n      let groupFormula = baseFormula;\n\n      const fieldsAliasList = groupFormula.match(/\\w+_field_id_\\d+/g) || [];\n\n      fieldsAliasList.forEach((alias: string) => {\n        let numeric = 0;\n        for (const field of data.values()) {\n          if (field.alias === alias) {\n            numeric =\n              typeof field.value === \"number\"\n                ? (field.value as number)\n                : Number(\n                    (field as any)?.displayValue\n                      ?.toString()\n                      ?.replace(/[^\\d.-]/g, \"\"),\n                  );\n            if (Number.isNaN(numeric)) numeric = 0;\n            break;\n          }\n        }\n\n        groupFormula = groupFormula.replace(\n          new RegExp(\"\\\\b\" + alias + \"\\\\b\", \"g\"),\n          numeric.toString(),\n        );\n      });\n\n      try {\n        const res = Number(eval(groupFormula));\n        return Number.isFinite(res) ? res : 0;\n      } catch {\n        return 0;\n      }\n    } else {\n      // Default behavior: sum fields that are added to summary\n      const items = Array.from(data.values()).filter(\n        (item: Field) => item.addToSummary,\n      );\n      return items.reduce((sum: number, item: Field) => {\n        const numeric =\n          typeof item.value === \"number\"\n            ? item.value\n            : Number(\n                (item as any)?.displayValue\n                  ?.toString()\n                  ?.replace(/[^\\d.-]/g, \"\"),\n              );\n        return sum + (isNaN(numeric) ? 0 : numeric);\n      }, 0);\n    }\n  };\n});\n</script>\n\n<style lang=\"scss\">\n.ccb-summary-repeater {\n  padding-left: 15px;\n\n  &__header {\n    display: grid;\n    grid-template-columns: 1fr auto;\n    align-items: center;\n    margin-bottom: 10px;\n    cursor: pointer;\n\n    &:not(:first-child) {\n      margin-top: 12px;\n    }\n\n    .ccb-summary-repeater__left {\n      display: flex;\n      align-items: center;\n      justify-content: flex-start;\n      gap: 4px;\n    }\n\n    .ccb-summary-repeater__btn {\n      cursor: pointer;\n      font-size: 10px;\n      margin-right: 4px;\n      color: var(--ccb-text-color);\n      transition: transform 0.4s;\n\n      &.rotated {\n        transform: rotate(180deg);\n      }\n    }\n\n    .ccb-summary-repeater__title {\n      font-size: var(--ccb-repeater-title-font-size);\n      font-weight: 700;\n      margin-right: 4px;\n      color: var(--ccb-text-color);\n    }\n\n    .ccb-summary-repeater__count {\n      font-size: var(--ccb-repeater-title-font-size);\n      font-weight: 600;\n      color: var(--ccb-summary-description-color);\n    }\n\n    .ccb-summary-repeater__value {\n      justify-self: end;\n      font-size: var(--ccb-summary-text-size);\n      font-weight: var(--ccb-summary-text-weight);\n      color: var(--ccb-text-color);\n      text-transform: var(--ccb-summary-text-transform);\n    }\n  }\n\n  &__list {\n    padding: 0 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n    transition: all 0.4s;\n    max-height: 2000px;\n    overflow: hidden;\n\n    &.hidden {\n      max-height: 0;\n    }\n  }\n}\n</style>\n"],"names":["data","item","alias","numeric","field","_b","_a","sum"],"mappings":"sjCAoDA,MAAM,MAAQ,QACR,CAAE,OAAA,EAAY,OAAO,KAAK,EAE1B,cAAgB,IAA6B,EAAE,EAE/C,iBAAmB,SAAS,IACxBA,GACC,MAAM,KAAKA,EAAK,OAAO,CAAC,EAAE,OAAQC,GAAgBA,EAAK,YAAY,CAE7E,EAEK,cAAgB,SAAS,IACrB,MAAqC,CACvC,GAAA,QAAQ,MAAM,cAAe,CAE/B,MAAM,YACH,QAAQ,MAAM,iBACb,QAAQ,MAAM,gBAAgB,KAC/B,GAAA,QAAQ,MAAM,SAAW,QAAQ,MAAM,QAAQ,QAChD,IAEF,IAAI,aAAe,YAEnB,MAAM,gBAAkB,aAAa,MAAM,mBAAmB,GAAK,CAAC,EAEpD,gBAAA,QAASC,GAAkB,SACzC,IAAIC,EAAU,EACH,UAAAC,KAAS,KAAK,SACnB,GAAAA,EAAM,QAAUF,EAAO,CACzBC,EACE,OAAOC,EAAM,OAAU,SAClBA,EAAM,MACP,QACGC,GAAAC,EAAAF,GAAA,YAAAA,EAAe,eAAf,YAAAE,EACG,aADH,YAAAD,EAEG,QAAQ,WAAY,GAC1B,EACF,OAAO,MAAMF,CAAO,IAAaA,EAAA,GACrC,KAAA,CAIJ,aAAe,aAAa,QAC1B,IAAI,OAAO,MAAQD,EAAQ,MAAO,GAAG,EACrCC,EAAQ,SAAS,CACnB,CAAA,CACD,EAEG,GAAA,CACF,MAAM,IAAM,OAAO,KAAK,YAAY,CAAC,EACrC,OAAO,OAAO,SAAS,GAAG,EAAI,IAAM,CAAA,MAC9B,CACC,MAAA,EAAA,CACT,KAMA,QAHc,MAAM,KAAK,KAAK,OAAQ,CAAA,EAAE,OACrCF,GAAgBA,EAAK,YACxB,EACa,OAAO,CAACM,EAAaN,IAAgB,SAChD,MAAME,EACJ,OAAOF,EAAK,OAAU,SAClBA,EAAK,MACL,QACGI,GAAAC,EAAAL,GAAA,YAAAA,EAAc,eAAd,YAAAK,EACG,aADH,YAAAD,EAEG,QAAQ,WAAY,GAC1B,EACN,OAAOE,GAAO,MAAMJ,CAAO,EAAI,EAAIA,IAClC,CAAC,CAER,CACD"}