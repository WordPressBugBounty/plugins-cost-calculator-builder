{"version":3,"file":"RangeTime-CjfP01Xs.js","sources":["../../src/widget/features/calculator-fields/components/TimePicker/styles/RangeTime.vue"],"sourcesContent":["<template>\n  <div class=\"ccb-range-timePicker\">\n    <div class=\"ccb-range-timePicker__from\">\n      <VueDatePicker\n        v-model=\"from\"\n        time-picker\n        :is-24=\"format\"\n        minutes-grid-increment=\"5\"\n        @update:model-value=\"handleFromUpdate\"\n      >\n        <template #input-icon>\n          <i class=\"ccb-icon-timepicker-light-clock\"></i>\n        </template>\n      </VueDatePicker>\n    </div>\n    <div class=\"ccb-range-timePicker__separator\">\n      <span>to</span>\n    </div>\n    <div class=\"ccb-range-timePicker__to\">\n      <VueDatePicker\n        v-model=\"to\"\n        time-picker\n        :is-24=\"format\"\n        minutes-grid-increment=\"5\"\n        @update:model-value=\"handleToUpdate\"\n      >\n        <template #input-icon>\n          <i class=\"ccb-icon-timepicker-light-clock\"></i>\n        </template>\n      </VueDatePicker>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch, onMounted } from \"vue\";\nimport VueDatePicker from \"@vuepic/vue-datepicker\";\nimport \"@vuepic/vue-datepicker/dist/main.css\";\nimport { useCallbackStore } from \"@/widget/app/providers/stores/callbackStore.ts\";\n\nconst callbackStore = useCallbackStore();\n\nconst props = defineProps<{\n  format: boolean;\n  minInterval: string;\n  modelValue?: {\n    from?: { hours: number; minutes: number; seconds: number };\n    to?: { hours: number; minutes: number; seconds: number };\n  } | null;\n}>();\n\nconst emit = defineEmits([\"update:modelValue\"]);\n\nconst parseInterval = (interval: string): number => {\n  const hoursMatch = interval.match(/(\\d+)h/);\n  const minutesMatch = interval.match(/(\\d+)m/);\n\n  const hours = hoursMatch ? parseInt(hoursMatch[1]) * 60 : 0;\n  const minutes = minutesMatch ? parseInt(minutesMatch[1]) : 0;\n\n  return hours + minutes;\n};\n\nconst from = ref<Date | { hours: number; minutes: number; seconds: number }>(\n  props.modelValue?.from || new Date(),\n);\n\nconst to = ref<Date | { hours: number; minutes: number; seconds: number }>(\n  props.modelValue?.to || new Date(),\n);\n\nonMounted(() => {\n  if (props.minInterval) {\n    const initialFromTime =\n      from.value instanceof Date\n        ? {\n            hours: from.value.getHours(),\n            minutes: from.value.getMinutes(),\n            seconds: 0,\n          }\n        : from.value;\n\n    handleFromUpdate(initialFromTime);\n  }\n});\n\nconst changeFormat = (val: string) => {\n  const [timePart, period] = val.toLowerCase().split(\" \");\n  const [hours, minutes] = timePart.split(\":\").map(Number);\n\n  let convertedHours = hours;\n  if (period === \"pm\" && hours !== 12) {\n    convertedHours = hours + 12;\n  } else if (period === \"am\" && hours === 12) {\n    convertedHours = 0;\n  }\n\n  return {\n    hours: convertedHours,\n    minutes: minutes,\n    seconds: 0,\n  };\n};\n\ncallbackStore.add(\n  \"updateRangeTimePicker\",\n  (val: { start: string; end: string }) => {\n    from.value = changeFormat(val.start);\n    to.value = changeFormat(val.end);\n  },\n);\n\nconst toDateFromTimeObject = (time: {\n  hours: number;\n  minutes: number;\n  seconds?: number;\n}): Date => {\n  const date = new Date();\n  date.setHours(time.hours);\n  date.setMinutes(time.minutes);\n  date.setSeconds(time.seconds || 0);\n  return date;\n};\n\nconst handleFromUpdate = (newTime: {\n  hours: number;\n  minutes: number;\n  seconds: number;\n}) => {\n  from.value = newTime;\n\n  const fromDate = toDateFromTimeObject(newTime);\n\n  if (props.minInterval) {\n    const interval = parseInterval(props.minInterval);\n    if (\"hours\" in to.value) {\n      const toDate = toDateFromTimeObject(to.value);\n      const diff = Math.abs(fromDate.getTime() - toDate.getTime()) / 1000 / 60;\n      if (interval < diff) {\n        return;\n      }\n    }\n\n    const newToDate = new Date(fromDate);\n    newToDate.setMinutes(newToDate.getMinutes() + interval);\n\n    to.value = {\n      hours: newToDate.getHours(),\n      minutes: newToDate.getMinutes(),\n      seconds: 0,\n    };\n  }\n};\n\nconst handleToUpdate = (newTime: {\n  hours: number;\n  minutes: number;\n  seconds: number;\n}) => {\n  to.value = newTime;\n\n  const toDate = toDateFromTimeObject(newTime);\n  if (props.minInterval) {\n    const interval = parseInterval(props.minInterval);\n    if (\"hours\" in from.value) {\n      const fromDate = toDateFromTimeObject(from.value);\n      const diff = (toDate.getTime() - fromDate.getTime()) / 1000 / 60;\n      if (interval < diff) {\n        return;\n      }\n    }\n\n    const newFromDate = new Date(toDate);\n    newFromDate.setMinutes(newFromDate.getMinutes() - interval);\n\n    from.value = {\n      hours: newFromDate.getHours(),\n      minutes: newFromDate.getMinutes(),\n      seconds: 0,\n    };\n  }\n};\n\nwatch([from, to], (newTime: unknown) => {\n  if (!Array.isArray(newTime)) return;\n\n  const formattedTime = newTime.map((time) => {\n    if (time instanceof Date) {\n      return {\n        hours: time.getHours(),\n        minutes: time.getMinutes(),\n        seconds: 0,\n      };\n    }\n    return time;\n  });\n\n  emit(\"update:modelValue\", formattedTime);\n});\n</script>\n\n<style lang=\"scss\">\n.ccb-range-timePicker {\n  display: flex;\n\n  &__separator {\n    padding: 0 10px;\n    border: 1px solid var(--ccb-fields-border-color);\n    background: var(--ccb-fields-bg-color);\n    border-right: none;\n    border-left: none;\n    min-height: 44px;\n    display: flex;\n    align-items: center;\n    font-weight: 500;\n    color: var(--ccb-text-color);\n\n    span {\n      font-size: var(--ccb-fields-button-size);\n\n      @media only screen and (max-width: 480px) {\n        font-size: var(--ccb-mobile-fields-button-size);\n      }\n    }\n  }\n\n  &__from {\n    input {\n      border-top-right-radius: 0;\n      border-bottom-right-radius: 0;\n    }\n  }\n\n  &__to {\n    input {\n      border-top-left-radius: 0;\n      border-bottom-left-radius: 0;\n    }\n  }\n}\n</style>\n"],"names":["callbackStore","useCallbackStore","props","__props","emit","__emit","parseInterval","interval","hoursMatch","minutesMatch","hours","minutes","from","ref","_a","to","_b","onMounted","initialFromTime","handleFromUpdate","changeFormat","val","timePart","period","convertedHours","toDateFromTimeObject","time","date","newTime","fromDate","toDate","diff","newToDate","handleToUpdate","newFromDate","watch","formattedTime"],"mappings":"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"}