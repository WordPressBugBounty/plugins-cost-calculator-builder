import{d as se,B as ie,e as b,f as h,c as d,o as n,l as o,m as v,M as N,h as x,u as s,N as U,a as B,L as f,F as ne,E as $,w as oe,O as ue,I as re}from"./runtime-dom.esm-bundler-q8x4SZ5d.js";import{u as ce,f as de,n as pe,p as ve,o as fe}from"./widget-oBzLET5U.js";import{u as _e}from"./translationsStore-C4wu_Y0X.js";import{H as me}from"./Hint-RbxMJKqa.js";import{_ as T}from"./RequiredHint.vue_vue_type_style_index_0_lang-D9F99cWG.js";import{c as he,_ as P}from"./ThankYouPage-BUPLrnRP.js";import"./jquery-C7OTzgKr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"ccb-field__label"},ye={class:"ccb-field__title"},Fe={key:0,class:"ccb-field-required-mark"},be={key:0,class:"ccb-field__descriptions ccb-before"},xe={key:0,class:"ccb-field__description"},ke={class:"ccb-file-upload__buttons"},we={key:1,class:"ccb-file-upload__upload-url"},Ce={class:"ccb-field__input-wrapper"},Se=["placeholder"],Ue={key:2},$e={key:1,class:"ccb-file-upload__files"},Te={class:"name"},Ae=["onClick"],Ve={key:3,class:"ccb-field__descriptions ccb-after"},ze={key:0,class:"ccb-field__description"},Be=["accept","multiple"],Re=se({__name:"FileUpload",props:{field:{},files:{}},setup(D){const L=D,{field:e,files:k}=ie(L),I=ce(),R=fe(),q=de(),O=pe(),E=ve(),m=_e(),g=b(null),i=b([]),y=b(""),w=b(!1),u=b(""),A=b(!1),j=()=>u.value="",H=h(()=>e.value.maxAttachedFiles||1),W=h(()=>e.value.maxFileSize||1),G=t=>{u.value="";const l=t.target;let a=[...i.value];if(Array.from((l==null?void 0:l.files)||[]).forEach(r=>{let c=r.name,p="",F=c.lastIndexOf(".");F!==-1&&(p=c.slice(F),c=c.slice(0,F));let S=a.filter(ae=>ae.name.startsWith(c)).length;S>0&&(c=`${c}(${S})`);let te=new File([r],c+p,{type:r.type});a.push(te)}),a=a.filter(r=>M(r)),e.value.maxAttachedFiles<a.length){let r=a.length-e.value.maxAttachedFiles;a.splice(a.length-r,r)}i.value=a,V()},J=t=>{u.value="",i.value.splice(t,1),g.value&&"value"in g.value&&(g.value.value=""),V()},K=()=>{var a,_,r,c;let t=[...i.value];if(e.value.maxAttachedFiles<t.length+1)return;let l=((c=(r=(_=(a=y.value)==null?void 0:a.split("/"))==null?void 0:_.pop())==null?void 0:r.split("#")[0])==null?void 0:c.split("?")[0])||"";fetch(y.value).then(async p=>p.ok?p.blob():(u.value="upload_url",!1)).then(p=>{if(p&&typeof p!="boolean"&&u.value!=="upload_url"){if(l.lastIndexOf(".")===-1){let S=p.type.split("/")[1].toLowerCase();l=l+"."+S}let F=new File([p],l,{type:p.type});M(F)&&i.value.push(F),V()}}).catch(()=>{u.value="upload_url"}),y.value=""},M=t=>{var _,r,c;let l=Number((t.size/1048576).toFixed(2));if(e.value.maxFileSize<l)return u.value="big_file_size",!1;const a=((c=(r=(_=t==null?void 0:t.name)==null?void 0:_.split("."))==null?void 0:r.pop())==null?void 0:c.toLowerCase())||"";return z.value.includes(a)?!0:(u.value="wrong_format",!1)},Q=()=>{C.value||(w.value=!w.value,y.value="")},X=()=>{var t;C.value||(w.value=!1,(t=g==null?void 0:g.value)==null||t.click())},V=()=>{var l,a;i.value.length===0&&((l=k==null?void 0:k.value)==null?void 0:l.length)!==0&&(i.value=k.value||[]);let t=i.value.length>0?e.value.price:0;e.value.allowPrice&&e.value.calculatePerEach&&(t=e.value.price*i.value.length),e.value.value=t,e.value.files=i.value||[],e.value.displayValue=((a=ee.value)==null?void 0:a.toString())||"",e.value.extraDisplayView=Z.value,typeof e.value.repeaterIdx<"u"&&(window.ccb_rep_files||(window.ccb_rep_files={}),window.ccb_rep_files[`${e.value.alias}_${e.value.repeaterIdx}`]=i.value),q.updateField(e.value.alias,e.value),O.applyConditionForField(e.value.alias)},z=h(()=>{const t=[];return e.value.fileFormats.forEach(l=>t.push.apply(t,l.split("/"))),t}),Y=h(()=>q.checkFieldRequired(e.value)?(u.value="required",!0):(u.value="",!1)),Z=h(()=>{if(!e.value.allowPrice)return"";if(e.value.calculatePerEach){const t=E.formatCurrency(e.value.price,E.getCurrencyOptions(e.value)),l=e.value.useCurrency?t:e.value.price;return`${i.value.length} file(s) x ${l}`}return`${i.value.length} file(s)`}),ee=h(()=>{var t;return e.value.allowPrice?e.value.useCurrency||e.value.fieldCurrency?R.getCommonFieldDisplayView(e.value):((t=e.value.value)==null?void 0:t.toString())||"":`${i.value.length} file(s)`}),C=h(()=>e.value.maxAttachedFiles<=i.value.length),le=h(()=>{var t;return((t=e.value)==null?void 0:t.additionalStyles)||""});return(t,l)=>(n(),d("div",{class:$(["ccb-field ccb-file-upload",{required:Y.value,"ccb-field-disabled":s(e).disabled,[le.value]:!0}])},[o("div",ge,[u.value!==""?(n(),d(N,{key:0},[u.value==="big_file_size"?(n(),x(s(T),{key:0,text:s(m).getTranslations.bigFileSize},null,8,["text"])):u.value==="wrong_format"?(n(),x(s(T),{key:1,text:s(m).getTranslations.wrongFileFormat},null,8,["text"])):u.value==="upload_url"?(n(),x(s(T),{key:2,text:s(m).getTranslations.wrongFileUrl},null,8,["text"])):(n(),x(s(T),{key:3,text:s(m).getTranslations.requiredField},null,8,["text"]))],64)):v("",!0),o("div",ye,[U(f(s(e).label),1),s(e).required?(n(),d("span",Fe,"*")):v("",!0),B(he),B(s(me),null,{content:ne(()=>[U(" Supported file types: "+f(z.value.map(a=>`.${a}`).join(", "))+" ",1),l[2]||(l[2]=o("br",null,null,-1)),U(" File size: "+f(W.value)+" MB ",1),l[3]||(l[3]=o("br",null,null,-1)),U(" Max "+f(H.value)+" files ",1)]),_:1})])]),s(I).getAppearanceDescriptionPosition==="before"?(n(),d("div",be,[s(e).description?(n(),d("div",xe,f(s(e).description),1)):v("",!0)])):v("",!0),l[5]||(l[5]=o("div",{class:"ccb-file-upload__input"},[o("input",{type:"file"})],-1)),o("div",ke,[B(s(P),{type:"success",class:$({"ccb-btn-disableWrong file formatd":C.value}),onClick:X,text:s(m).getTranslations.chooseFile},null,8,["class","text"]),s(e).uploadFromUrl?(n(),x(s(P),{key:0,type:"light",text:"Upload from URL",class:$({"ccb-btn-disabled":C.value}),onClick:Q},null,8,["class"])):v("",!0)]),w.value?(n(),d("div",we,[o("div",Ce,[oe(o("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),type:"text",placeholder:s(m).getTranslations.enterFileUrl,onInput:j},null,40,Se),[[ue,y.value]])]),o("div",null,[o("button",{class:$(["upload",{"ccb-btn-disabled":!y.value.length}]),onClick:K},f(s(m).getTranslations.upload),3)])])):v("",!0),i.value.length>0?(n(),d("div",Ue,[i.value.length>3?(n(),d("div",{key:0,class:"ccb-file-upload__file-list",onClick:l[1]||(l[1]=a=>A.value=!A.value)},[o("span",null,f(i.value.length)+" "+f(s(m).getTranslations.filesUploaded),1)])):v("",!0),i.value.length<=3||A.value?(n(),d("div",$e,[(n(!0),d(N,null,re(i.value,(a,_)=>(n(),d("div",{key:_,class:"ccb-file-upload__file"},[o("span",Te,f(a.name),1),o("span",{class:"action",onClick:()=>J(_)},l[4]||(l[4]=[o("i",{class:"ccb-icon-close"},null,-1)]),8,Ae)]))),128))])):v("",!0)])):v("",!0),s(I).getAppearanceDescriptionPosition==="after"?(n(),d("div",Ve,[s(e).description?(n(),d("div",ze,f(s(e).description),1)):v("",!0)])):v("",!0),o("input",{ref_key:"fileElement",ref:g,style:{display:"none"},type:"file",accept:z.value.map(a=>`.${a}`).join(","),multiple:(s(e).maxAttachedFiles||1)>1,onChange:G},null,40,Be)],2))}});export{Re as default};
//# sourceMappingURL=index-CVQjfged.js.map
