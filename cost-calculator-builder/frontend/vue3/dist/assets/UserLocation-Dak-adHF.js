import{_ as M,b as me}from"./ThankYouPage-CD4sYaJx.js";import{f as ye,n as _e,o as fe,p as he,i as Ce,k as we}from"./widget-CufK5hD0.js";import{L as ke,u as be}from"./index-D2tDBmJP.js";import{u as xe}from"./translationsStore-DAijv8YO.js";import{d as Se,B as Fe,e as v,f as m,k as Le,c as V,o as D,l as i,a as C,L as E,u as r,F as Pe,E as Be}from"./runtime-dom.esm-bundler-B-pJJbN8.js";import"./jquery-C7OTzgKr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"ccb-user-location"},Ve={class:"ccb-user-location__input-wrapper"},De={class:"label"},Ee={class:"ccb-user-location__description"},Ie={key:0},$e={key:1,class:"ccb-user-location__adressname"},Te={class:"ccb-location-modal"},Ae={class:"ccb-location-modal__body"},Ne=["id"],Ge={class:"ccb-location-modal__search"},Ke=["id","placeholder"],Oe={class:"ccb-location-modal__footer"},Qe=Se({__name:"UserLocation",props:{field:{}},setup(J){const h=Ce(),I=we(),Q=J,{field:e}=Fe(Q),$=ye(),T=_e(),W=fe(),A=he(),p=xe(),w=v(),{getGoogleApiKey:X,mapOptions:Y,generateId:Z,parseLocationCoordinates:N,calculateValueByEachCost:G,getMeasure:k,eachCost:ee,getMarkerIconPath:K}=be(),te=new ke({apiKey:X(),version:"weekly",libraries:["places","geometry"]});let u=v({lat:51.554867,lng:-.109112}),b=v([]),c=v(""),y=Z(4),_=v(0),oe=v(""),g;const x=m(()=>{var t;return{value:{pricingType:e.value.pricingType,eachCost:String(e.value.eachCost),distanceCostList:e.value.distanceCostList.map(o=>({from:o.from,to:o.to,cost:String(o.cost)})),lastDistanceCost:{cost:String(((t=e.value.lastDistanceCost)==null?void 0:t.cost)||"0")}}}}),S=m(()=>e.value.userLocation),ae=m(()=>c.value.length>40?`${c.value.slice(0,40)} + ...`:c.value),se=m(()=>{var t;return e.value.useCurrency?W.getCommonFieldDisplayView(e.value):((t=e.value.value)==null?void 0:t.toString())||""}),ne=m(()=>{const t=A.getCurrencyOptions(e.value),o=t.currency,l=t.currencyPosition;let s=0;e.value.value&&(s=ee(_.value,x.value));const a=A.parseCurrencyPosition(s.toString(),o,l||"left");let n=e.value.useCurrency?`${a}`:s;return`Distance: ${_.value} ${k()} x ${n}`}),O=m(()=>`${e.value.alias}-search-input-${y}`),F=()=>{te.load().then(async()=>{const{Map:t}=await google.maps.importLibrary("maps");g=new t(document.getElementById(y),{...Y(),mapId:y,center:{...u.value}});const o=document.getElementById(O.value),l=new google.maps.places.SearchBox(o);g.addListener("bounds_changed",()=>{l.setBounds(g.getBounds())}),l.addListener("places_changed",()=>{const s=l.getPlaces();if((s==null?void 0:s.length)===0)return;const a=new google.maps.LatLngBounds;s==null||s.forEach(n=>{if(!n.geometry||!n.geometry.location)return;const d={lat:n.geometry.location.lat(),lng:n.geometry.location.lng()};U(d),n.geometry.viewport?a.union(n.geometry.viewport):a.extend(n.geometry.location),c.value=n.formatted_address||"",u.value.lat=n.geometry.location.lat(),u.value.lng=n.geometry.location.lng()}),g.fitBounds(a)}),g.addListener("click",s=>{const a=s.latLng;U({lat:(a==null?void 0:a.lat())||0,lng:(a==null?void 0:a.lng())||0}),u.value.lat=(a==null?void 0:a.lat())||0,u.value.lng=(a==null?void 0:a.lng())||0,new google.maps.Geocoder().geocode({location:a},(d,f)=>{f==="OK"&&Array.isArray(d)&&d[0]&&(c.value=d[0].formatted_address,o.value=d[0].formatted_address)})})})},ie=()=>{c.value=""},le=()=>{w.value.showPopup()},L=()=>{w.value.hidePopup()},R=()=>{b.value.forEach(t=>{t.map=null}),b.value=[]},U=async t=>{R();const o=document.createElement("img");o.style.width="40px",o.style.height="40px",o.src=K();const{AdvancedMarkerElement:l}=await google.maps.importLibrary("marker"),s=new l({position:t,map:g});K()&&(s.content=o),b.value.push(s)},ce=()=>{if(c.value){ie();const t=document.getElementById(y);R(),t&&(t.value=""),de(),L()}},re=()=>{const t=new google.maps.DirectionsService,o=N(S.value.toString()),l=u.value,a={origin:o,destination:l,waypoints:[{location:o,stopover:!0},{location:l,stopover:!0}],travelMode:google.maps.TravelMode.DRIVING},n=k();return new Promise(d=>{t.route(a,(f,ge)=>{var q,z;if(ge==="OK"){const H=((z=(q=f==null?void 0:f.routes[0])==null?void 0:q.legs)==null?void 0:z.reduce((ve,B)=>{var j;return ve+(((j=B==null?void 0:B.distance)==null?void 0:j.value)||0)},0))||0;let P;n==="miles"?P=(H*621371e-9).toFixed(2):P=(H*.001).toFixed(2),d(P)}})})},ue=async()=>{c.value&&(_.value=Number(await re()),oe.value=`${G(_.value,x.value)} ${k()}`,pe(),L())},de=()=>{e.value.value=0,e.value.displayValue="0",e.value.extraDisplayView=[],$.updateField(e.value.alias,e.value),T.applyConditionForField(e.value.alias),h.getPageBreakEnabled()&&h.getActivePage().action==="not_skip"&&I.checkPageFieldsConditions()},pe=()=>{e.value.value=parseFloat(G(_.value,x.value).toFixed(2))||0,e.value.displayValue=se.value,e.value.extraDisplayView=[ae.value.toString(),ne.value.toString()],$.updateField(e.value.alias,e.value),T.applyConditionForField(e.value.alias),h.getPageBreakEnabled()&&h.getActivePage().action==="not_skip"&&I.checkPageFieldsConditions()};return Le(()=>{S.value&&(u.value=N(S.value.toString())),"geolocation"in navigator?navigator.geolocation.getCurrentPosition(t=>{const o=t.coords.latitude,l=t.coords.longitude;u.value={lat:o,lng:l},F()},()=>{F()}):F()}),(t,o)=>(D(),V("div",Me,[i("div",Ve,[i("button",{class:"ccb-user-location__action",onClick:le},[o[0]||(o[0]=i("span",{class:"icon"},[i("i",{class:"ccb-icon-location"})],-1)),i("span",De,E(r(p).getTranslations.openMap),1)]),i("div",Ee,[r(c)?(D(),V("span",$e,E(r(c)),1)):(D(),V("span",Ie,E(r(p).getTranslations.chooseFromMap),1))])]),C(me,{ref_key:"popup",ref:w},{default:Pe(()=>[i("div",Te,[i("div",Ae,[i("div",{id:r(y),class:"ccb-location-modal__map"},null,8,Ne),i("div",Ge,[o[1]||(o[1]=i("i",{class:"ccb-icon-Search-Magnifier"},null,-1)),i("input",{id:O.value,class:"controls",type:"text",placeholder:r(p).getTranslations.searchLocation},null,8,Ke)])]),i("div",Oe,[C(M,{type:"light",text:r(p).getTranslations.clearLocation,class:Be(["clear",{disable:!r(c)}]),"on-click":ce},null,8,["text","class"]),C(M,{type:"light",text:r(p).getTranslations.cancel,"on-click":L},null,8,["text"]),C(M,{type:"success",text:r(p).getTranslations.saveLocation,"on-click":ue},null,8,["text"])])])]),_:1},512)]))}});export{Qe as default};
//# sourceMappingURL=UserLocation-Dak-adHF.js.map
