import{a as ie,t as ne,l as b,b as m,n as d,g as n,q as o,s as v,F as P,f as x,u as s,E as U,p as q,v as f,w as oe,A as T,G as ue,I as re,z as ce}from"./convert-case-to-camel-case.utils-C0gHQHtf.js";import{u as de,f as pe,n as ve,a as fe,p as _e,o as me}from"./widget-EtDMYrRk.js";import{u as ge}from"./translationsStore-Ca2Pe_Lt.js";import{H as he}from"./Hint-BI4B_lwQ.js";import{_ as $}from"./RequiredHint.vue_vue_type_style_index_0_lang-DHSb8rQ5.js";import{c as ye,_ as D}from"./ThankYouPage-BQZhcTRI.js";import"./jquery-C7OTzgKr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe={class:"ccb-field__label"},be={class:"ccb-field__title"},xe={key:0,class:"ccb-field-required-mark"},ke={key:0,class:"ccb-field__descriptions ccb-before"},we={key:0,class:"ccb-field__description"},Ce={class:"ccb-file-upload__buttons"},Se={key:1,class:"ccb-file-upload__upload-url"},Ue={class:"ccb-field__input-wrapper"},Te=["placeholder"],$e={key:2},Ae={key:1,class:"ccb-file-upload__files"},ze={class:"name"},Ve=["onClick"],qe={key:3,class:"ccb-field__descriptions ccb-after"},Ie={key:0,class:"ccb-field__description"},Be=["accept","multiple"],Oe=ie({__name:"FileUpload",props:{field:{},files:{}},setup(N){const L=N,{field:e,files:k}=ne(L),I=de(),R=me(),B=pe(),W=ve(),E=_e(),g=ge(),h=b(null),i=b([]),y=b(""),w=b(!1),u=b(""),A=b(!1),O=()=>u.value="",j=m(()=>{var l;return((l=fe().getWarningTexts)==null?void 0:l.requiredMsg)||""}),H=m(()=>e.value.maxAttachedFiles||1),G=m(()=>e.value.maxFileSize||1),J=t=>{u.value="";const l=t.target;let a=[...i.value];if(Array.from((l==null?void 0:l.files)||[]).forEach(r=>{let c=r.name,p="",F=c.lastIndexOf(".");F!==-1&&(p=c.slice(F),c=c.slice(0,F));let S=a.filter(se=>se.name.startsWith(c)).length;S>0&&(c=`${c}(${S})`);let ae=new File([r],c+p,{type:r.type});a.push(ae)}),a=a.filter(r=>M(r)),e.value.maxAttachedFiles<a.length){let r=a.length-e.value.maxAttachedFiles;a.splice(a.length-r,r)}i.value=a,z()},K=t=>{u.value="",i.value.splice(t,1),h.value&&"value"in h.value&&(h.value.value=""),z()},Q=()=>{var a,_,r,c;let t=[...i.value];if(e.value.maxAttachedFiles<t.length+1)return;let l=((c=(r=(_=(a=y.value)==null?void 0:a.split("/"))==null?void 0:_.pop())==null?void 0:r.split("#")[0])==null?void 0:c.split("?")[0])||"";fetch(y.value).then(async p=>p.ok?p.blob():(u.value="upload_url",!1)).then(p=>{if(p&&typeof p!="boolean"&&u.value!=="upload_url"){if(l.lastIndexOf(".")===-1){let S=p.type.split("/")[1].toLowerCase();l=l+"."+S}let F=new File([p],l,{type:p.type});M(F)&&i.value.push(F),z()}}).catch(()=>{u.value="upload_url"}),y.value=""},M=t=>{var _,r,c;let l=Number((t.size/1048576).toFixed(2));if(e.value.maxFileSize<l)return u.value="big_file_size",!1;const a=((c=(r=(_=t==null?void 0:t.name)==null?void 0:_.split("."))==null?void 0:r.pop())==null?void 0:c.toLowerCase())||"";return V.value.includes(a)?!0:(u.value="wrong_format",!1)},X=()=>{C.value||(w.value=!w.value,y.value="")},Y=()=>{var t;C.value||(w.value=!1,(t=h==null?void 0:h.value)==null||t.click())},z=()=>{var l,a;i.value.length===0&&((l=k==null?void 0:k.value)==null?void 0:l.length)!==0&&(i.value=k.value||[]);let t=i.value.length>0?e.value.price:0;e.value.allowPrice&&e.value.calculatePerEach&&(t=e.value.price*i.value.length),e.value.value=t,e.value.files=i.value||[],e.value.displayValue=((a=le.value)==null?void 0:a.toString())||"",e.value.extraDisplayView=ee.value,typeof e.value.repeaterIdx<"u"&&(window.ccb_rep_files||(window.ccb_rep_files={}),window.ccb_rep_files[`${e.value.alias}_${e.value.repeaterIdx}`]=i.value),B.updateField(e.value.alias,e.value),W.applyConditionForField(e.value.alias)},V=m(()=>{const t=[];return e.value.fileFormats.forEach(l=>t.push.apply(t,l.split("/"))),t}),Z=m(()=>B.checkFieldRequired(e.value)?(u.value="required",!0):(u.value="",!1)),ee=m(()=>{if(!e.value.allowPrice)return"";if(e.value.calculatePerEach){const t=E.formatCurrency(e.value.price,E.getCurrencyOptions(e.value)),l=e.value.useCurrency?t:e.value.price;return`${i.value.length} file(s) x ${l}`}return`${i.value.length} file(s)`}),le=m(()=>{var t;return e.value.allowPrice?e.value.useCurrency||e.value.fieldCurrency?R.getCommonFieldDisplayView(e.value):((t=e.value.value)==null?void 0:t.toString())||"":`${i.value.length} file(s)`}),C=m(()=>e.value.maxAttachedFiles<=i.value.length),te=m(()=>{var t;return((t=e.value)==null?void 0:t.additionalStyles)||""});return(t,l)=>(n(),d("div",{class:T(["ccb-field ccb-file-upload",{required:Z.value,"ccb-field-disabled":s(e).disabled,[te.value]:!0}])},[o("div",Fe,[u.value!==""?(n(),d(P,{key:0},[u.value==="big_file_size"?(n(),x(s($),{key:0,text:s(g).getTranslations.bigFileSize},null,8,["text"])):u.value==="wrong_format"?(n(),x(s($),{key:1,text:s(g).getTranslations.wrongFileFormat},null,8,["text"])):u.value==="upload_url"?(n(),x(s($),{key:2,text:s(g).getTranslations.wrongFileUrl},null,8,["text"])):(n(),x(s($),{key:3,text:j.value},null,8,["text"]))],64)):v("",!0),o("div",be,[U(f(s(e).label),1),s(e).required?(n(),d("span",xe,"*")):v("",!0),q(ye),q(s(he),null,{content:oe(()=>[U(" Supported file types: "+f(V.value.map(a=>`.${a}`).join(", "))+" ",1),l[2]||(l[2]=o("br",null,null,-1)),U(" File size: "+f(G.value)+" MB ",1),l[3]||(l[3]=o("br",null,null,-1)),U(" Max "+f(H.value)+" files ",1)]),_:1})])]),s(I).getAppearanceDescriptionPosition==="before"?(n(),d("div",ke,[s(e).description?(n(),d("div",we,f(s(e).description),1)):v("",!0)])):v("",!0),l[5]||(l[5]=o("div",{class:"ccb-file-upload__input"},[o("input",{type:"file"})],-1)),o("div",Ce,[q(s(D),{type:"success",class:T({"ccb-btn-disableWrong file formatd":C.value}),onClick:Y,text:s(g).getTranslations.chooseFile},null,8,["class","text"]),s(e).uploadFromUrl?(n(),x(s(D),{key:0,type:"light",text:"Upload from URL",class:T({"ccb-btn-disabled":C.value}),onClick:X},null,8,["class"])):v("",!0)]),w.value?(n(),d("div",Se,[o("div",Ue,[ue(o("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),type:"text",placeholder:s(g).getTranslations.enterFileUrl,onInput:O},null,40,Te),[[re,y.value]])]),o("div",null,[o("button",{class:T(["upload",{"ccb-btn-disabled":!y.value.length}]),onClick:Q},f(s(g).getTranslations.upload),3)])])):v("",!0),i.value.length>0?(n(),d("div",$e,[i.value.length>3?(n(),d("div",{key:0,class:"ccb-file-upload__file-list",onClick:l[1]||(l[1]=a=>A.value=!A.value)},[o("span",null,f(i.value.length)+" "+f(s(g).getTranslations.filesUploaded),1)])):v("",!0),i.value.length<=3||A.value?(n(),d("div",Ae,[(n(!0),d(P,null,ce(i.value,(a,_)=>(n(),d("div",{key:_,class:"ccb-file-upload__file"},[o("span",ze,f(a.name),1),o("span",{class:"action",onClick:()=>K(_)},l[4]||(l[4]=[o("i",{class:"ccb-icon-close"},null,-1)]),8,Ve)]))),128))])):v("",!0)])):v("",!0),s(I).getAppearanceDescriptionPosition==="after"?(n(),d("div",qe,[s(e).description?(n(),d("div",Ie,f(s(e).description),1)):v("",!0)])):v("",!0),o("input",{ref_key:"fileElement",ref:h,style:{display:"none"},type:"file",accept:V.value.map(a=>`.${a}`).join(","),multiple:(s(e).maxAttachedFiles||1)>1,onChange:J},null,40,Be)],2))}});export{Oe as default};
//# sourceMappingURL=index-CURBqDTr.js.map
