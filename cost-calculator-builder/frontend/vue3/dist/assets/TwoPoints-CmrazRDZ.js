import{d as ge,t as fe,k as y,m as _e,c as b,l as B,o as A,p as n,n as S,s as p,u as i,D as E,w as he,E as Y,H as Z,z as ye}from"./pinia-CqDt-rav.js";import{_ as O,b as we}from"./ThankYouPage-DnlVAEwa.js";import{n as Ce,f as Le,j as be,o as ke,p as Ne}from"./widget-vibN-GXC.js";import{L as Te,u as xe}from"./index-Co-OPvub.js";import{u as Fe}from"./translationsStore-B4g6iBqy.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./jquery-C7OTzgKr.js";const De={class:"ccb-two-points-location"},Me={class:"ccb-two-points-location__input-wrapper"},Pe={class:"label"},Ie={class:"ccb-two-points-location__description"},$e={key:0},Ve={key:1,class:"ccb-two-points-location__adressname"},Be={class:"ccb-location-modal"},Ae={class:"ccb-location-modal__body"},Ee={class:"ccb-location-modal__sidebar"},Oe={class:"ccb-location-modal__inputs"},Ge={class:"ccb-location-modal__input"},Re={for:"latitude"},Ke=["id","placeholder"],je={class:"ccb-location-modal__input"},qe={for:"longitude"},ze=["id","placeholder"],He={class:"ccb-location-modal__distance"},Ue=["id"],Je={class:"ccb-location-modal__footer"},Qe=ge({__name:"TwoPoints",props:{field:{}},setup(ee){const oe=ee,{field:t}=fe(oe),ae=ke(),G=Ce(),w=Le(),R=Ne(),c=Fe(),K=be(),D=y(),{getGoogleApiKey:te,mapOptions:se,generateId:ne,getMeasure:T,getMarkerIconPath:j,calculateValueByEachCost:le,eachCost:ie,generateGoogleLink:q}=xe();let k=ne(4),z=y({lat:51.554867,lng:-.109112}),e=y({from:{addressName:"",coordinates:{lat:0,lng:0}},to:{addressName:"",coordinates:{lat:0,lng:0}}}),g=y(""),C=y("from"),f=y(null),m=y({from:null,to:null});const re=new Te({apiKey:te(),version:"weekly",libraries:["places","geometry"]});_e(()=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(o=>{const a=o.coords.latitude,s=o.coords.longitude;let l={lat:a,lng:s};z.value=l,M()},()=>{M()}):M()});let x;const M=()=>{re.load().then(async()=>{const{Map:o}=await google.maps.importLibrary("maps");x=new o(document.getElementById(k),{...se(),mapId:k,center:{...z.value}});const a=document.getElementById($.value),s=document.getElementById(V.value),l=new google.maps.places.SearchBox(a),r=new google.maps.places.SearchBox(s);l.addListener("places_changed",()=>{U(l,"from")}),r.addListener("places_changed",()=>{U(r,"to")}),google.maps.event.addListener(x,"click",d=>{if(C){const v={lat:d.latLng?d.latLng.lat():0,lng:d.latLng?d.latLng.lng():0};e.value[C.value].coordinates=v,me(C.value,v);const _=C.value==="from"?$.value:V.value;new google.maps.Geocoder().geocode({location:d.latLng},(u,F)=>{var L;if(F==="OK"&&u&&u.length>0){const N=u[0].formatted_address;(L=document.getElementById(_))==null||L.setAttribute("value",N),e.value[C.value].addressName=N,e.value.from.coordinates&&e.value.to.coordinates&&J()}else console.error("Geocoding failed:",F)})}})})},ce=()=>{I.value&&de()},de=()=>{t.value.value=parseFloat(le(parseFloat(g.value),X.value).toFixed(2)),t.value.displayValue=pe.value,t.value.extraDisplayView=[`${c.getTranslations.from}: ${e.value.from.addressName.length>30?e.value.from.addressName.slice(0,30)+"...":e.value.from.addressName}`,`${c.getTranslations.toDestination}: ${e.value.to.addressName.length>34?e.value.to.addressName.slice(0,34)+"...":e.value.to.addressName}`,`${W.value}`];const o={distance:g.value,distance_view:W.value,measure:T(),eachCost:t.value.eachCost,twoPoints:{from:{addressName:e.value.from.addressName,coordinates:e.value.from.coordinates,addressLink:q(e.value.from.coordinates)},to:{addressName:e.value.to.addressName,coordinates:e.value.to.coordinates,addressLink:q(e.value.to.coordinates)}}};t.value.userSelectedOptions=o,w.updateField(t.value.alias,t.value),G.applyConditionForField(t.value.alias),w.getPageBreakEnabled&&w.getActivePage.action==="not_skip"&&K.checkPageFieldsConditions(),P()},H=o=>{C.value=o},ue=()=>{t.value.userSelectedOptions={},Object.values(m.value).forEach(o=>{o&&(o.map=null)}),m.value.from=null,m.value.to=null,f.value!==null&&f.value.setMap(null),g.value="0",e.value={from:{addressName:"",coordinates:{lat:0,lng:0}},to:{addressName:"",coordinates:{lat:0,lng:0}}},t.value.value=0,t.value.displayValue="",t.value.extraDisplayView=[],w.updateField(t.value.alias,t.value),G.applyConditionForField(t.value.alias),w.getPageBreakEnabled&&w.getActivePage.action==="not_skip"&&K.checkPageFieldsConditions(),P()},me=async(o,a)=>{o==="from"&&m.value.from?(m.value.from.map=null,m.value.from=null):o==="to"&&m.value.to&&(m.value.to.map=null,m.value.to=null);const s=document.createElement("img");s.style.width="40px",s.style.height="40px",s.src=j();const{AdvancedMarkerElement:l}=await google.maps.importLibrary("marker"),r=new l({position:a,map:x});j()&&(r.content=s),o==="from"?m.value.from=r:m.value.to=r},U=(o,a)=>{var v,_,h,u;const s=o.getPlaces()||[];if(!Array.isArray(s)||(s==null?void 0:s.length)===0)return;const l=s[0],r={lat:((_=(v=l==null?void 0:l.geometry)==null?void 0:v.location)==null?void 0:_.lat())||0,lng:((u=(h=l==null?void 0:l.geometry)==null?void 0:h.location)==null?void 0:u.lng())||0},d=l.formatted_address;e.value[a].coordinates={lat:r.lat,lng:r.lng},e.value[a].addressName=d||"",e.value.from.coordinates&&e.value.to.coordinates&&J()},J=async()=>{try{const o=await Q();g.value=o,f.value&&(f.value.setMap(null),f.value=null);const a=new google.maps.DirectionsService;f.value=new google.maps.DirectionsRenderer({suppressMarkers:!0}),f.value&&f.value.setMap(x);const s=[{location:e.value.from.coordinates,stopover:!0},{location:e.value.to.coordinates,stopover:!0}],l=new google.maps.LatLng(e.value.from.coordinates),r=new google.maps.LatLng(e.value.to.coordinates),d={origin:l,destination:r,waypoints:s,travelMode:google.maps.TravelMode.DRIVING};a.route(d,(v,_)=>{var h;_==="OK"&&((h=f.value)==null||h.setDirections(v),Q().then(u=>{g.value=u}))})}catch(o){throw o}},Q=()=>{const o=new google.maps.DirectionsService,a=[{location:new google.maps.LatLng(e.value.from.coordinates.lat,e.value.from.coordinates.lng),stopover:!0},{location:new google.maps.LatLng(e.value.to.coordinates.lat,e.value.to.coordinates.lng),stopover:!0}],s={origin:new google.maps.LatLng(e.value.from.coordinates.lat,e.value.from.coordinates.lng),destination:new google.maps.LatLng(e.value.to.coordinates.lat,e.value.to.coordinates.lng),waypoints:a,travelMode:google.maps.TravelMode.DRIVING};return new Promise(l=>{o.route(s,(r,d)=>{var v,_;if(d==="OK"){const h=((_=(v=r==null?void 0:r.routes[0])==null?void 0:v.legs)==null?void 0:_.reduce((F,L)=>{var N;return F+(((N=L==null?void 0:L.distance)==null?void 0:N.value)||0)},0))||0;let u;T()==="miles"?u=(h*621371e-9).toFixed(2):u=(h*.001).toFixed(2),l(u)}})})},ve=()=>{D.value.showPopup()},P=()=>{D.value.hidePopup()},pe=b(()=>{var o;return t.value.useCurrency?ae.getCommonFieldDisplayView(t.value):((o=t.value.value)==null?void 0:o.toString())||""}),W=b(()=>{const o=R.getCurrencyOptions(t.value),a=o.currency,s=o.currencyPosition;let l=0;t.value.value&&(l=ie(parseFloat(g.value),X.value));const r=R.parseCurrencyPosition(l.toString(),a,s||"left");let d=t.value.useCurrency?`${r}`:l;return`${c.getTranslations.distance}: ${g.value} ${T()} x ${d}`}),I=b(()=>e.value.from.addressName&&e.value.to.addressName&&g.value),X=b(()=>{var o;return{value:{pricingType:t.value.pricingType,eachCost:String(t.value.eachCost),distanceCostList:t.value.distanceCostList.map(a=>({from:a.from,to:a.to,cost:String(a.cost)})),lastDistanceCost:{cost:String(((o=t.value.lastDistanceCost)==null?void 0:o.cost)||"0")}}}}),$=b(()=>`${t.value.alias}-locationFrom-${k}`),V=b(()=>`${t.value.alias}-locationTo-${k}`);return(o,a)=>(A(),B("div",De,[n("div",Me,[n("button",{class:"ccb-two-points-location__action",onClick:ve},[a[4]||(a[4]=n("span",{class:"icon"},[n("i",{class:"ccb-icon-location"})],-1)),n("span",Pe,p(i(c).getTranslations.openMap),1)]),n("div",Ie,[I.value?(A(),B("span",Ve,[n("span",null,p(i(c).getTranslations.from)+":",1),E(" "+p(i(e).from.addressName)+" ",1),a[5]||(a[5]=n("br",null,null,-1)),n("span",null,p(i(c).getTranslations.to)+":",1),E(" "+p(i(e).to.addressName),1)])):(A(),B("span",$e,p(i(c).getTranslations.chooseFromMap),1))])]),S(we,{ref_key:"popup",ref:D},{default:he(()=>[n("div",Be,[n("div",Ae,[n("div",Ee,[n("div",Oe,[n("div",Ge,[n("label",Re,p(i(c).getTranslations.from),1),Y(n("input",{id:$.value,type:"text",placeholder:i(c).getTranslations.enterAddress,"onUpdate:modelValue":a[0]||(a[0]=s=>i(e).from.addressName=s),onClick:a[1]||(a[1]=s=>H("from"))},null,8,Ke),[[Z,i(e).from.addressName]])]),n("div",je,[n("label",qe,p(i(c).getTranslations.toDestination),1),Y(n("input",{id:V.value,"onUpdate:modelValue":a[2]||(a[2]=s=>i(e).to.addressName=s),type:"text",placeholder:i(c).getTranslations.enterAddress,onClick:a[3]||(a[3]=s=>H("to"))},null,8,ze),[[Z,i(e).to.addressName]])])]),n("div",He,[E(p(i(c).getTranslations.distance)+": ",1),n("span",null,p(`${i(g)} ${i(T)()}`),1)])]),n("div",{id:i(k),class:"ccb-location-modal__map"},null,8,Ue)]),n("div",Je,[S(O,{type:"light",text:i(c).getTranslations.clearLocation,class:ye(["clear",{disable:!I.value}]),onClick:ue},null,8,["text","class"]),S(O,{type:"light",text:i(c).getTranslations.cancel,onClick:P},null,8,["text"]),S(O,{type:"success",text:i(c).getTranslations.saveLocation,onClick:ce},null,8,["text"])])])]),_:1},512)]))}}),to=Se(Qe,[["__scopeId","data-v-4004dfcd"]]);export{to as default};
//# sourceMappingURL=TwoPoints-CmrazRDZ.js.map
